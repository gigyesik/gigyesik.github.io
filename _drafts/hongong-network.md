# 혼자 공부하는 네크워크

## 02. 물리 계층과 데이터 링크 계층 (74p~)

### 02-1. 이더넷 (76p~)

- 이더넷(ethernet) : 통신 매체 규격, 송수신 프레임 형태, 방법 등을 정의하는 네트워크 기술
- 이더넷 표준 : IEEE 802.3
- 통신 매체(간선) 표기 형태 : {전송속도}BASE-{추가특성}
  - 전송 속도 : 10, 100, 1000, 2.5G, 5G, 10G, 40G, 100G (Mbps, Gbps)
  - BASE(BASEband) : 변조 타입(modulation type). 비트 신호를 통신 매체로 전송하는 방법
  - 추가 특성 : 통신 매체 종류, 전송 가능 최대 거리, 물리 계층 인코딩(X), 전송로(레인. R) 수 등
  - 통신 매체 종류
    - C : 동축 케이블
    - T : 트위스티드 페어 케이블
    - S : 단파장 광섬유 케이블
    - L : 장파장 광섬유 케이블
  - 1000BASE-SX : 1000Mbps 속도를 지원하는 단파장 광섬유 케이블
- 이더넷 프레임(ethernet frame) : 데이터 링크 계층 전송 데이터의 형태
  - 헤더
    - 프리앰블(preamble) : 이더넷 init 신호. 8바이트(64비트). 시작 10101010, 끝 10101011
    - 송수신지 MAC 주소 : 인터페이스(장치. LAN 카드) 주소
      - 8바이트(64비트). ex) AB-CD-EF-AB-CD-01 (16진수 12자. 1자당 4비트)
    - 타입, 길이 : 1500(05DC) 이하면 길이, 1536(0600) 이상이면 타입
      - 0800(IPv4), 86DD(IPv6), 0806(ARP)
  - 페이로드
    - 데이터 : 최대 1500바이트. 46 바이트 미만이면 0으로 패딩(padding)
  - 트레일러
    - FCS(Frame Check Sequence) : 오류 확인 필드. CRC(Cyclic Redundancy Check) 값 비교
    - MAC 주소 ~ 페이로드 까지 CRC 값 비교하여 일치하지 않으면 프레임 폐기

### 02-2. NIC 와 케이블 (88p~)

- NIC(Network Interface Controller) : 호스트와 유무선 통신 매체 연결과 변환, MAC 주소를 부여하는 네트워크 장비. LAN 카드
- 케이블(Cable) : NIC 에 연결되는 물리 계층 유선 통신 매체
  - 트위스티드 페어 케이블(twisted pair cable) : 랜선. 구리선
    - 표기 형태 : XX/YTP
      - U : 실드 없음, S : 브레이브 실드, F : 포일 실드
      - SF/FTP : 케이블 외부 브레이브, 포일 실드 / 케이블 내부 구리선쌍 포일 실드
    - 전송 속도에 따른 분류 : Cat5(100Mbps) ~ Cat8(40Gbps)
  - 광섬유 케이블(fiber optic cable) : 장거리 전송용 광통신 케이블
    - 싱글 모드 : 빛의 전반사 경로가 하나. 손실 적으므로 장거리 전송 가능. 가격 비쌈
      - 장파장 사용. 1000BASE-LX
    - 멀티 모드 : 경로 여러개. 장거리 전송 부적합
      - 단파장 사용. 1000BASE-SX

### 02-3. 허브 (102p~)

- 주소(address) 는 MAC 주소부터 있는 개념이므로 1계층(물리) 에서는 사용되지 않고, 2계층(데이터 링크) 부터 사용된다.
- 허브(hub) : 여러 대의 호스트를 연결하는 장치
  - 신호를 전달받으면 송신지를 제외한 모든 포트로 내보낸다.
  - 반이중 모드로 통신한다. (무전기처럼 송수신을 교대로. 동시에 송신시 충돌)
    - 콜리전 도메인(collision domain) : 같은 허브에 연경되어 있는 호스트 집합. 충돌 발생 가능 영역
  - cf. 전이중 모드 : 송수신을 동시에 할 수 있음
  - CSMA/CD 프로토콜 (Carrier Sense Multiple Access with Collision Detection)
    - CS : 캐리어 감지. 네트워크상 전송 중인 신호가 있는지 확인
    - MA : 다중 접근. 다른 호스트가 전송중이지 않을 때 전송
    - CD : 충돌 검출. 충돌이 발생한 경우 각 호스트에게 잼 신호(jam signal) 을 보내고, 일정 시간 대기 후 재전송
- 리피터(repeater) : 전기 신호 증폭 장치
- 이더넷 허브 : 이더넷 네트워크의 허브

### 02-4. 스위치 (112p~)

- 스위치(layer 2 switch, L2 switch) : 전이중 통신, MAC 주소 학습을 지원하는 2계층 네트워크 장비
  - MAC 주소 학습(MAC address learning) : 원하는 호스트에만 프레임 전달 가능 
    - 플러딩(flooding) : 허브처럼 송신지 제외 모든 포트에 프레임 전송
    - 필터링(filtering) : 플러딩 이후 어떤 포트에 프레임을 보낼지 결정하는 것
    - 포워딩(forwarding) : 프레임이 전송될 포트에 프레임을 보내는 것
  - MAC 주소 테이블(MAC address table) : 스위치 포트와 호스트 MAC 주고 연관 관계 테이블. 스위치 메모리에 보관
    - 송신 호스트가 프레임을 송신하면, 플러딩 발생하며 MAC 주소 테이블에 송신지 MAC 주소 기록
    - 응답 호스트가 응답 프레임을 전송하면, 수신지 MAC 주소 기록
    - 나머지 호스트는 응답 폐기
    - 에이징(aging) : 특정 포트에서 일정 시간 동안 프레임을 전송받지 못한 경우 테이블에서 폐기하는 것
- VLAN(Virtual LAN) : 호스트의 물리적 위치와 관계없이 논리적으로 LAN 구성
  - 포트 기반 VLAN(port based VLAN) : VLAN 트렁킹(VLAN Trunking)
    - VLAN 트렁킹 : 트렁크 포트(trunk port. 두 스위치의 공통 포트)에 VLAN 스위치 연결
    - 프레임의 VLAN 식별 : 802.1Q 프레임. 이더넷 프레임의 헤어네 VLAN 태그(32비트) 부착
  - MAC 기반 VLAN(MAC based VLAN) : 포트와 관계없이 MAC 주소 기반으로 VLAN 설정

## 03. 네트워크 계층 (126p~)

### 03-1. LAN 을 넘어서는 네트워크 계층 (128p~)

- 1계층(물리 계층), 2계층(데이터 링크 계층) 만으로 모든 전송을 하지 못하는 이유
  - 다른 네트워크까지의 도달 경로를 알 수 없다. -> 라우터(router)
  - 모든 네트워크에 속한 호스트의 위치를 알 수 없다. -> IP + MAC 함께 사용
- 라우팅(routing) : 패킷이 이동할 최적의 경로를 결정하는 것. 라우터가 수행
- IP 주소 : 논리 주소. '호스트' 에 할당
  - DHCP(Dynamic Host Configuration Protocol) 로 자동 할당하거나, 직접 할당 가능.
  - 한 호스트가 복수의 주소를 갖는 것도 가능
- IP(Internet Protocol)
  - IP 주소 지정(IP addressing) : IP 주소를 바탕으로 송수신 대상을 지정하는 것
  - IP 단편화(IP fragmentation) : 패킷이 MTU 보다 크기가 클 경우 복수의 패킷으로 나누는 것
    - MTU(Maximum Transmission Unit) : 한 번에 전송 가능한 IP 패킷의 헤더 포함한 최대 크기. 일반적으로 1500바이트
    - 경로 MTU(Path MTU) : 단편화 없이 전송할 수 있는 최대 크기
  - IPv4 : RFC-791
    - 주소 형태 : 옥텟(octet. 0~2^8 사이의 10진수) 4개. ex) 255.255.255.255
      - 4바이트(32비트). 옥텟 하나당 8비트(1바이트)
    - IPv4 패킷 : 프레임의 페이로드 (데이터 필드). 아래는 IPv4 의 헤더들
      - 식별자(identifier) : 패킷에 할당된 변호. 패킷이 단편화된 경우의 일련번호
      - 플래그(flag) : 3비트
        - 예약 비트. 항상 0으로 현재 사용하지 않음
        - DF(Don't Fragment) : 1이면 단편화 off, 0이면 단편화 on. 1인데 크기 초과한 경우 폐기
        - MF(More Fragment) : 0이면 마지막 패킷, 1이면 다른 단편화 패킷 더 있음
      - 단편화 오프셋(fragment offset) : 패킷 초기 데이터로부터 떨어진 위치 (순서 보장되지 않으므로)
      - TTL(Time To Live) : 한 홉마다(hop) 1씩 감소하여 0이 되면 패킷 폐기하고 호스트에게 Time Exceed 메시지 전송(ICMP)
        - 홉 : 패킷이 호스트 또는 라우터에 1번 전달되는 것
      - 프로토콜 : 상위 계층 프로토콜 정보. TCP 6번, UDP 17번
      - 송신지 IP 주소(source IP address)
      - 수신지 IP 주소(destination IP address)
  - IPv6 : IPv4 의 고갈을 막기 위해 등장한 IP 주소
    - IPv6 패킷 : IPv4 에 비해 간소화되어있음(기본 헤더). 
      - 다음 헤더(next header) : 간소화된 기본 헤더 이외의 확장 헤더
        - 기본 헤더와 페이로드 사이에 위치
        - 홉 간 옵션, 수신지 옵션, 라우팅, 단편화 등
        - 단편화 확장 헤더 : IPv6 의 단편화를 담당하는 확장 헤더
          - 예약됨(reserved), 예약(res) : 0으로 현재 사용하지 않음
          - 단편화 오프셋, M flag(IPv4의 MF), 식별자
      - 홉 제한(hot limit) : TTL
      - 송신지 IP 주소
      - 수신지 IP 주소
- ARP(Address Resolution Protocol) : IP 주소를 통해 MAC 주소를 알아내는 프로토콜
  - ARP 요청(ARP request) : 네트워크 내 모든 호스트에게 ARP 패킷 브로드캐스트 메시지
    - 프레임 페이로드(데이터) 내 포함
      - 오퍼레이션 코드(Opcode) : 1이면 ARP 요청, 2이면 ARP 응답
      - 송신지, 수신지 하드웨어 주소(Sender, Target Hardware Address) : MAC 주소. ff:~:ff, 00:~:00
      - 송신지, 수신지 프로토콜 주소(Sender, Target Protocol Address) : IP 주소
  - ARP 응답(ARP reply) : 해당하는 MAC 주소의 호스트가 송신자에게 응답 패킷 전송
  - ARP 테이블(ARP table) 갱신 : IP 주소와 MAC 주소 대응 표

### 03-2. IP 주소 (148p~)

- IP 주소(IP address) : 네트워크 주소(network identifier) + 호스트 주소(host identifier)
  - 클래스풀 주소 체계(classful addressing)
    - A 클래스 : 8/24
      - 초기 비트 0 (10진수 0)
      - 할당 범위 0.0.0.0 ~ 127.255.255.255
    - B 클래스 : 16/16
      - 초기 비트 10 (10진수 128)
      - 할당 범위 128.0.0.0 ~ 191.255.255.255
    - C 클래스 : 24/8
      - 초기 비트 110 (10진수 192)
      - 할당 범위 192.0.0.0 ~ 223.255.255.255
    - 호스트 주소 전부 0 : 해당 네트워크 자체
    - 호스트 주소 전수 1 : 브로드캐스트 전용
  - 클래스리스 주소 체계(classless addressing) : 서브네팅(subnetting)
    - 서브넷 마스크(subnet mask) : 네트워크 주소는 1, 호스트 주소는 0으로 표기한 비트열
      - IP 주소와 서브넷 마스크를 비트 AND 연산(bitwise AND operation) 하면 네트워크 주소를 알 수 있다.
      - ex) 172.29.208.1, 255.255.240.0 -> 172.29.208.0
      - CIDR 표기법(Classless Inter-Domain Routing notation) : IP 주소 / 서브넷 마스크상 1의 갯수
      - ex) 172.29.208.1/20
  - 공인 IP 주소와 사설 IP 주소
    - 공인 IP 주소(public IP address) : 고유 IP. ISP 나 할당기관을 통해 할당 가능
    - 사설 IP 주소(private IP address) : 사설 네트워크 IP. 라우터가 할당
      - 10.0.0.0/8(10.0.0.0 ~ 10.255.255.255.255)
      - 172.16.0.0/12(172.16.0.0 ~ 172.31.255.255)
      - 192.168.0.0/16(192.168.0.0 ~ 192.168.255.255)
    - NAT(Network Address Translation) : 공인 IP 와 사설 IP 변환 기술. 라우터 또는 공유기
  - 정적 IP 주소와 동적 IP 주소
    - 정적 IP 주소(static IP address) : 호스트에 수동으로 IP 주소 할당
      - 기본 게이트웨이(default gateway) : 호스트가 속한 네크워크 외부로 나가기 위한 첫 경로(첫 번째 홉). 공유기 주소
    - 동적 IP 주소(dynamic IP address) : 호스트에 자동으로 IP 주소 할당
      - DHCP(Dynamic Host Configuration Protocol) : IP 동적 할당 프로토콜. 호스트와 DHCP 서버간 통신
        - DHCP Discover(Client -> DHCP) : 송신지 주소 0.0.0.0 으로 DHCP 서버 검색(브로드캐스트)
        - DHCP Offer(DHCP -> Client) : 할당해 줄 IP 주소 제안
        - DHCP Request(Client -> DHCP) : 브로드캐스트로 IP 주소 사용 요청
        - DHCP ACK(Acknowledge)(DHCP -> Client) : 클라이언트에게 IP 주소 할당(임대)
        - 임대 기간이 끝나면 재할당하거나 임대 갱신(lease renewal)
- 예약 주소
  - 루프백(loopback address) : 127.0.0.0/8(127.0.0.0 ~ 127.255.255.255)
    - 로컬호스트(localhost)
    - 자기 자신을 호스트인 양 사용하여 패킷 전송 가능
  - 이 네트워크의 이 호스트 : 0.0.0.0/8(0.0.0.0 ~ 0.255.255.255.255)
  - 모든 임의의 IP 주소 : 0.0.0.0/0. 디폴트 라우트(default route) 결정

### 03-3. 라우팅 (170p~)

- 라우팅 : 라우터의 핵심 기능. 패킷이 이동할 경로를 설정하고 이동시키는 것
- 라우터 : 3계층의 핵심 장비
  - 공유기 : 홈 라우터(home router). 라우터 + NAT + DHCP + 방화벽
  - 홉(hop) : 라우터와 라우터 간 이동하는 하나의 과정
    - 라우팅 테이블(routing table) : 수신지까지 도달 정보를 명시한 표
      - 수신지 IP 주소, 서브넷 마스크 : 최종 패킷 전달 대상
      - 다읍 홉(next hop) : 게이트웨에. 다음으로 거쳐야 할 호스트의 IP 주소 또는 인터페이스
      - 네트워크 인터페이스 : 패킷을 내보낼 통로. NIC 또는 인터페이스에 대응하는 IP
      - 메트릭(metric) : 해당 경로로 이동하는 데 드는 비용
    - 디폴트 라우트(default route) : 기본 게이트웨이로 패킷을 내보낼 경로. 0.0.0.0/0
- 정적 라우팅과 동적 라우팅 : 라우팅 테이블을 만드는 방법
  - 정적 라우팅(static routing) : 수동으로 채운 라우팅 테이블을 기반으로 라우팅하는 방식
  - 동적 라우팅(dynamic routing) : 자동으로 라우팅 테이블을 만들고 이를 이용하여 라우팅하는 방식
    - AS(Autonomous System) : 한 회사나 집단에서 관리하는 라우터 집단 네크워크
      - AS 밖과 통신할 때는 AS 경계 라우터(ASBR; Autonomous System Boundary Router) 사용
- 라우팅 프로토콜(routing protocol) : 패킷 이동 최적 경로 찾는 프로토콜
  - IGP(Interior Gateway Protocol) : AS 내부 수행 라우팅 프로토콜
    - RIP(Routing Information Protocol) : 거리 벡터(distance vector) 사용
      - 경로 정보를 주기적으로 교환하여 라우팅 테이블 갱신
      - 홉 수가 가장 적은 경로를 최적 경로로 판단
    - OSPF(Open Shortest Path First) : 링크 상태(link state) 사용
      - 네트워크의 그래프를 링크 상태 데이터베이스에 저장(LSDB; Link State DataBase)
      - LSDB 를 기반으로 최적 경로 선택
      - 네트워크 구성이 변경되었을 때 갱신
        - 에어리어(area)로 구획화하고 내부에서만 링크 상태 공유. 경계 라우터 ABR(Area Border Router)
  - EGP(Exterior Gateway Protocol) : AS 외부 수행 라우팅 프로토콜
    - BGP(Border Gateway Protocol) : AS 간 통신 프로토콜(eBGP; external) (AS 내부 통신도 가능. iBGP; internal)
      - 피어(peer) : BGP 메시지를 주고받을 수 있도록 연결된 ASBR
      - 속성(attribute) : 경로 결정에 대한 부가 정보
        - AS-PATH : 수신지에 이르는 과정에서 통과하는 AS 들의 목록
          - 라우팅 시 라우터 수가 아님 'AS 수' 가 최단경로 기준이므로, AS-PATH 가 짧아도 통과해야 하는 라우터 수가 많을 수 있음 
          - '거리'가 아닌 '경로' 를 고려(경로 벡터. path vector). 자신의 AS 가 PATH 상에 포함되면 순환으로 간주해 폐기
        - NEXT-HOP : 다음으로 거칠 라우터의 주소
        - LOCAL-PREF(preference) : 정책으로 설정한 선호도값. AS-PATH 나 NEXT-HOP 보다 우선 적용
      - 정책(policy) : 경로 결정을 의도를 가지고 수동으로 제어

## 04. 전송 계층 (188p~)

### 04-1. 전송 계층 개요. IP의 한계와 포트 (190p~)

- IP 의 한계
  - 신뢰할 수 없는(비신뢰성) 프로토콜(unreliable protocol) : 패킷의 수신지까지 전달을 보장하지 않음
  - 비연결형 프로토콜(connectionless protocol) : 송수신 호스트간 연결 작업을 하지 않음
- 전송 계층의 IP 한계 보완
  - TCP 연결 수립
  - TCP 를 통해 재전송을 통한 오류 제어, 흐름 제어, 혼잡 제어
- 포트(port) : 특정 어플리케이션을 식별할 수 있는 정보
  - 패킷의 최종 수신 대상은 특정 어플리케이션 프로세스
  - 프로세스 : 실행 중인 프로그램. PID(Process ID)로 구별
  - 포트의 분류
    - 잘 알려진 포트(well known port) : 0~1023
      - FTP(20, 21), SSH(22), TELNET(23), 53(DNS), DHCP(67, 68), HTTP(80), HTTPS(443) 등
    - 등록된 포트(registered port) : 1024~49151
      - MySQL(3306), Redis(6379), HTTP 대체(8080) 등
    - 동적 포트(dynamic port) : 사설 포트(private port), 임시 포트(ephemeral port). 49152~65535 (2^16 -1)
  - 특정 호스트에서 실행 중인 특정 어플리케이션 프로세스 : {IP 주소}:{포트 번호}
- 포트 기반 NAT
  - NAT 변환 테이블 : 사설 IP 공인 IP 주소를 변환
  - NAPT(Network Address Port Translation) : APT(Address Port Translation)
    - 포트를 활용해 하나의 공인 IP 주소를 여러 사설 IP 주소가 공유할 수 있도록 하는 NAT
- 포트 포워딩(port forwarding) : 네트워크 내 특정 호스트에 IP 주소와 포트 번호를 미리 할당하여 패킷 전달하는 기능
- ICMP(Internet Control Message Protocol) : 네트워크 계층 프로토콜
  - IP 한계 보완 목적. ICMP 메시지 수신(하지만 보조적인 역할일 뿐 전송 계층 필요. RFC-792)
  - traceroute, tracert, ping
  - 타입(type), 코드(code)
    - 3 : 패킷 수신지 도달 불가
      - 0 : 네트워크 도달 불가
      - 1 : 호스트 도달 불가
      - 2 : 프로토콜 도달 불가(수신지에서 프로토콜 사용 불가)
      - 3 : 포트 도달 불가
      - 4 : 단편화가 필요하지만 DF 가 1로 설정되어 있음
    - 11 : 시간 초과
      - 0 : TTL 만료
    - 8 : 에코 요청
      - 0 : 에코 요청
    - 0 : 에코 응답
      - 0 : 에코 요청에 대한 응답
    - 9 : 라우터 광고
      - 0 : 라우터가 호스트에게 자신을 알림

### 04-2. TCP 와 UDP (208p~)

- TCP(Transmission Control Protocol) : stateful, 연결형, 신뢰할 수 있는
  - 세그먼트(segment) : 전송 계층의 페이로드(데이터)
    - 송신지 포트와 수신지 포트(source, destination port) : 포트 번호 명시
    - 순서 번호(sequence number) : 세그먼트의 올바른 순서를 보장하기 위해 첫 바이트에 부여
      - 첫 세그먼트의 순서 번호는 무작위로 부여(초기 순서 번호. ISN; Initial Sequence Number)
      - 다음 세그먼트의 순서 번호는 'ISN + 송신한 바이트 수' (ISN + 초기 순서 번호로부터의 거리)
      - 순서 번호는 4바이트(32비트). 최대값을 넘어서면 0부터 다시 증가
    - 확인 응답 번호(acknowledgment number) : 다음으로 수신하기를 기대하는 순서 번호
      - 수신 번호에 대한 응답
      - 수신한 순서 번호 + 1
    - 제어 비트(control bits) : 플래그 비트(flag bits). 세그먼트의 부가 정보
      - ACK(1) : 세그먼트 승인
      - SYN(1) : 연결 수립
      - FIN(1) : 연결 종료
    - 윈도우(window) : 한 번에 수신하고자 하는 데이터의 양(윈도우)
  - MSS(Maximum Segment Size) : TCP 로 전송할 수 있는 최대 페이로드 크기 (TCP 헤더 제외)
  - 연결 수립 : three-way handshake
    - 클라이언트 -> 서버 : SYN 세그먼트, 초기 순서번호 전송 (액티브 오픈. active open)
    - 서버 -> 클라이언트 : SYN 세그먼트, ACK 세그먼트, 초기 순서번호, 확인 응답 번호 (패시브 오픈. passive open)
    - 클라이언트 -> 서버 : ACK 세그먼트, 다음 순서번호, 확인 응답 번호
  - 연결 종료 : four-way handshake
    - 클라이언트 -> 서버 : FIN 세그먼트 (액티브 클로즈. active close)
    - 서버 -> 클라이언트 : ACK 세그먼트, 확인 응답 번호
    - 서버 -> 클라이언트 : FIN 세그먼트 (패시브 클로즈. passive close)
    - 클라이언트 -> 서버 : ACK 세그먼트, 확인 응답 번호
  - TCP 상태(stateful protocol)
    - 연결이 수립되지 않은 상태
      - CLOSED : 아무 연결도 없는 상태
      - LISTEN : SYN 세그먼트를 기다리고 있는 상태
    - 연결 수립 상태
      - SYN-SENT : 액티스 오픈 호스트가 SYN 세그먼트를 보내고 SYN + ACK 세그먼트를 기다리는 상태
      - SYN-RECEIVED : 패시브 오픈 호스트가 SYN + ACK 세그먼트를 보내고 ACK 세그먼트를 기다리는 상태
      - ESTABLISHED : 마지막 ACK 세그먼트를 주고받고 연결이 확립된 상태
    - 연결 종료 상태
      - FIN-WAIT-1 : 액티브 클로즈 호스트가 FIN 세그먼트를 보내고 ACK 세그먼트를 기다리는 상태
      - CLOSE-WAIT : 패시브 클로즈 호스트가 ACK 세그먼트를 보내고 대기중인 상태
      - FIN-WAIT-2 : 액티브 클로즈 호스트가 ACK 세그먼트를 받고 FIN 세그먼트를 기다리는 상태
      - LAST-ACK : 패시브 클로즈 호스트가 FIN 세그먼트를 보내고 ACK 세그먼트를 기다리는 상태
      - TIME-WAIT : 액티브 클로즈 호스트가 ACK 세그먼트를 보내고 대기중인 상태
        - ACK 세그먼트를 수신받지 못한 경우 재전송해야 하므로 일정 시간 대기
      - CLOSED
        - 액티브 클로즈 호스트 : TIME-WAIT 상태에서 일정 시간 경과 후 전이
        - 패시브 클로즈 호스트 : LAST-ACK 상태에서 ACK 세그먼트를 수신하면 전이
      - CLOSING : 동시에 FIN 세그먼트를 보낸 경우의 상태
        - 서로에게 ACK 세그먼트를 보내고, 수신한 호스트는 TIME-WAIT 상태가 되어 일정 시간 경과 후 CLOSED 된다.
- UDP(User Datagram Protocol) : stateless, 비연결형, 신뢰할 수 없는
  - 송신지 포트와 수신지 포트
  - 길이 : UDP 데이터그램의 바이트 (헤더 포함)
  - 체크섬 : 오류 발생 검사 필드
    - 훼손 여부를 판단하는 것이지 수신지 도달 여부를 판단하지는 않음(비신뢰성)

### 04-3. TCP 의 오류, 흐름, 혼잡 제어 (226p~)

- 오류 제어 : 오류 검출과 재전송
  - 중복된 ACK 세그먼트 수신
    - 수신 호스트 측에서 세그먼트 번호가 누락된 경우 중복 ACK 전송
    - RTT(Round Trip Time) : 메시지를 전송한 뒤 답변을 받는 데 걸리는 시간
  - 타임아웃 발생
    - 타임아웃(timeout) : 송신 호스트의 재전송 타이머(retransmission timer) 카운트 만료 상황
    - ARO(Automatic Repeat Request) : 자동 재전송 기법
      - Stop-and-Wait ARQ
        - 제대로 전발받음을 확인하기 전까지는 새로운 메시지를 보내지 않는 방식
        - 네트워크 이용 효율이 낮음 (응답 받기 전까지 다음 메시지를 보내지 않으므로)
      - Go-Back-N ARQ
        - 파이프라이닝(pipelining) : 연속해서 메시지를 전송하는 기술
        - 한 번에 여러 세그먼트를 전송하고 수신 실패한 세그먼트부터 재전송하는 방식
        - 누적 확인 응답(CACK; Cumulative Acknowledgement) : 특정 세트먼트의 확인 ACK 는 특정 세그먼트까지는 모두 성공했다는 의미
        - 빠른 재전송(fast transmit) : 세 번의 동인한 ACK 세그먼트가 수신되면 타임아웃에 관계없이 세그먼트 재전송하는 기능
      - Selective Repeat ARQ
        - 개별 확인 응답(SACK; Selective Acknowledgement) : 수신 호스트가 수신 성공한 패킷에 대해서만 ACK 세그먼트를 보내는 방식
        - 현재 대부분의 TCP 통신에서 지원하며, 미지원하는 경우 Go-Back-N 으로 동작 (TCP 헤더 SACK 필드로 확인)
- 흐름 제어 (flow control) : 수신 윈도우가 한 번에 처리 가능한 세그먼트의 양 특정
  - 수신 윈도우(RWND; Receiver WiNDow), 슬라이딩 윈도우 (sliding window) : 송수신 윈도우 영역이 한 칸씩 이동하면서 전송 데이터를 특정하는 것
    - TCP 헤더에 포함(수신 호스트가 송신 호스트에게 알려줘야 하므로)
    - 윈도우(window) : 송신 호스트가 파이프라이닝 할 수 있는 최대량
    - 수신 버퍼 : 수신 세그먼트의 임시 저장 공간
    - 송신 버퍼 : 송신 세그먼트의 임시 저장 공간
    - 버퍼 오버플로(buffer overflow) : 버퍼의 크기보다 많은 데이터를 전송하려는 경우 넘치는 현상
- 혼잡 제어 (congestion control) : 송신 호스트가 혼잡 없이 전송 가능한 전송량 조절
  - 혼잡 붕괴(congestion collapse) : 혼잡으로 인해 전송률이 떨어지는 현상
  - 혼잡 윈도우(CWND; congestion window) : 혼잡 없이 전송할 수 있을 것으로 예상되는 데이터양
    - TCP 헤더에 미포함(송신 호스트가 자체적으로 계산하는 값이므로)
    - 혼잡 윈도우의 크기 : 혼잡 제어 알고리즘(congestion control algorithm)
      - AIMD(Addictive Increase/Multiplicative Decrease)
        - 혼잡이 감지되지 않으면 RTT 마다 혼잡 윈도우 1 증가
        - 혼잡이 감지되면 혼잡 윈도우 절반으로 감소
        - 초기 전송속도가 느림 (혼잡 윈도우 선형증가)
      - 느린 시작 알고리즘(slow start)
        - 혼잡 윈도우 1부터 시작
        - 수신 ACK 세그먼트 하나당 혼잡 윈도우 1 증가 (즉 총 혼잡 윈도우는 지수증가)
        - AIMD 에 비해 초기 전송속도 빠름 (혼잡 윈도우 지수증가)
        - 느린 시작 임계치(SSTHRESH; slow start threshold) : 혼잡 윈도우 임계치
          - 타임아웃 발생 : 혼잡 윈도우 1, 느린 시작 임계치를 절반으로 초기화하고 느린 시작 알고리즘 재개
          - 혼잡 윈도우 >= 느린 시작 임계치 : 혼잡 윈도우를 절반으로 초기화하고 혼잡 회피 알고리즘 수행
          - 세 번의 중복 ACK 발생 : 빠른 재전송 후 빠른 회복 알고리즘 수행
      - 혼잡 회피 알고리즘(congestion avoidance)
        - RTT 마다 혼잡 윈도우 1MSS(Maximum Segment Size) 증가 (선형증가)
        - 혼잡 회피 도중 타임아웃 : 혼잡 윈도우 1, 느린 시작 임계치 절반으로 초기화하고 느린 시작 알고리즘 재개
        - 혼잡 회피 도중 세 번의 중복 ACK 발생 : 혼잡 윈도우, 느린 시작 임계치 절반으로 초기화하고 빠른 회복 알고리즘 수행
      - 빠른 회복 알고리즘(fast recovery)
        - 세 번의 중복 ACK 를 수신한 경우 느린 시작 알고리즘을 건너뛰고 혼잡 회피 알고리즘을 수행
        - 빠른 회복 도중 타임아웃 : 혼잡 윈도우 1, 느린 시작 임계치 절반으로 초기화하고 느린 시작 알고리즘 수행
    - 명시적 혼잡 알림(ECN; Explicit Congestion Notification)
      - 네트워크 장치(주로 라우터)가 수행
      - IP, TCP 헤더에 ECN 필드 추가(서비스 유형 필드 내 오른쪽 두개 비트. TCP: CWR + ECE)
      - 송신 호스트가 라우터에 메시지 전송
      - 라우터가 혼잡을 판단한 경우 ECN 비트를 11로(혼잡 감지. congestion experienced) 수신 호스트에게 전송
      - 수신 호스트는 ECE 비트를 세팅해서 송신 호스트에게 ACK 메시지 전송
      - 송신 호스트는 CWR 비트 세팅 후 혼잡 윈도후 절반으로 감소

## 05. 응용 계층 (250p~)

### 05-1. DNS 와 자원 (252p~)

- 도메인 네임과 네임 서버
  - 도메인 네임(domain name) : 호스트의 IP 주소와 대응되는 문자열 호스트 정보 (example.com)
  - 네임 서버(name server) : IP 주소와 도메인 네임을 관리하는 서버 (공용 전화번호부)
    - DNS(Domain Name Server) : 도메인 네임을 관리하는 서버
    - DNS(Domain Name System) : 분산된 도메인 네임의 관리 체계
  - host 파일 : 도메인 네임과 IP 주소의 대응 관계를 담은 파일 (개인 전화번호부)
    - mac, linux : /etc/hosts
    - windows : \SystemRoot\System32\drivers\etc\hosts
  - 전체 주소 도메인 네임(FDQN; Fully-Qualified Domain name) ex. www.example.com.
    - 루트 도메인(root domain) : 마지막 .
    - 최상위 도메인(TLD; Top-Level Domain) : com
    - 2단계 도메인(second-level domain) : example
    - 3단계 도메인(호스트 네임. host name) : www
    - 서브 도메인 : 자기 앞. example.com 은 com 의 서브 도메인
- 계층적 네임 서버
  - 리졸빙(resolving) : IP 주소를 모르는 상태에서 도메인 네임에 해당하는 IP 를 알아내는 과정(IP 주소 풀이)
  - 로컬 네임 서버(local name server) : ISP 가 할당해주는 클라이언트와 닿아 있는 네임 서버
  - 공개 DNS 서버(public DNS server) : 로컬 네임 서버 대신 구글의 8.8.8.8 등 이용 가능
  - 루트 네임 서버(root name server) : 루트 도메인을 관리하는 네임 서버
  - TLD 네임 서버(TLD name server) : TLD 를 관리하는 네임 서버
  - 책임 네임 서버(authoritative name server) : 특정 도메인 영역을 관리하는 네임 서버
    - 로컷 네임 서버가 마지막으로 질의하는 네임 서버. 곧바로 IP 주소 응답 가능
  - 재귀적 질의(recursive query)
    - 클라이언트 -> 로컬(공개) -> 루트 -> TLD -> 책임(IP) -> TLD -> 루트 -> 로컬(공개) -> 클라이언트
  - 반복적 질의(iterative query)
    - 클라이언트 -> 로컬(공개)
    - 로컬(공개) -> 루트 -> 로컬(공개)
    - 로컬(공개) -> TLD -> 로컬(공개)
    - 로컬(공개) -> 책임(IP) -> 로컬(공개)
    - 로컬(공개) -> 클라이언트
  - DNS 캐시(DNS cache) : 네임 서버들이 응답 결과를 임시 저장했다가 같은 질의에 활용하는 것
    - TTL(Time To Live) : 캐시(임시저장)될 수 있는 시간
- URI(Uniform Resource Identifier) : 네트워크상에서 자원을 식별하는 방식
  - 자원(Resource) : 네트워크상 메시지를 통해 주고받는 대상(내용)
  - URL(Uniform Resource Locator) : 위치를 이용해 자원 식별 
    - ex. foo://www.example.com:8042/over/there?name=gigyesik#eyes
    - scheme : `foo://`
      - 자원에 접근하는 방법(프로토콜)
      - HTTP, HTTPS 등
    - authority : `www.example.com:8042`
      - IP 주소 또는 도메인 네임
      - 포트 포함
    - path : `/over/there`
      - 자원이 위치하는 경로
    - query(query string, query parameter) : `?name=gigyesik`
      - 서버에 요청을 보낼 때 사용하는 값
    - fragment : `#eyes`
      - 자원의 특정 부분 지칭
  - URN(Uniform Resource Name) : 이름을 이용해 자원 식별
    - 도서 코드 `urn:isbn:045140523`
    - rfc 문서 번호 `urn:ietf:rfc:2648`
- DNS 레코드 타입
  - DNS 자원 레코드(DNS resource record) : 도메인 네임과 IP 주소의 대응 관계를 저장하는 값
    - 타입
      - A : IPv4
      - AAAA : IPv6
      - CNAME : 호스트 네임의 별칭
      - NS : 네임 서버 지정
      - MX : 메일 서버
    - 이름
    - 값
    - TTL
    - 예시 (타입 / 이름 / 값 / TTL)
      - A, example.com, 1.2.3.4, 300 : IPv4 주소 1.2.3.4 와 example.com 대응
      - CNAME, www.example.com, example.com, 300 : www.example.com 을 질의해도 1.2.3.4 를 응답받을 수 있음

### 05-3. HTTP (272p~)

- HTTP(Hypertext Transfer Protocol) : 응용 계층 프로토콜
  - 요청, 응답 기반 (Request, Response Header)
  - 미디어 독립적 : 자원의 특성과 무관
    - 자원(resource) : HTTP 가 요청하는 대상 
    - 미디어 타입(media type), MIME 타입(Multipurpose Internet Mail Extensions Type) : 메시지로 주고받는 자원의 종류
      - `type/subtype;parameter=value` ex. application/json, text/html;charset=UTF-8, \*/\*
      - 타입(type) : 데이터의 유형
      - 서브타입(subtype) : 타입의 세부 유형
      - parameter, value : 부사적인 설명
  - 상태를 유지하지 않음(스테이트리스; stateless) : 서버는 HTTP 요청을 보낸 클라이언트의 상태를 기억하지 않음
    - 확장성(scalability) : 언제든 요철할 서버를 추가할 수 있음
    - 견고성(robustness) : 서버 중 하나에 문제가 생겨도 다른 서버로 대체 가능
  - 지속 연결(persistent connection)
    - HTTP 1.1 이상에서 지원
    - keep-alive. 즉 하나의 TCP 연결로 여러 개의 요청, 응답을 주고받을 수 있음
- HTTP 메시지 구조
  - 시작 라인(start-line)
    - 요청 라인(request-line) : HTTP 요청 메시지인 경우
      - `메서드 (공백) 요청 대상 (공백) HTTP 버전 (줄바꿈)`
      - 메서드(method) : 작업의 종류. GET, POST, PUT, DELETE 등
      - 요청 대상(request-target) : 요청을 보낼 서버의 자원. 쿼리가 포함된 URI 경로
      - HTTP 버전(HTTP-version) : 사용된 HTTP 버전. HTTP/<버전> 형식
    - 상태 라인 : HTTP 응답 메시지인 경우
      - `HTTP 버전 (공백) 상태 코드 (공백) 이유 구문(선택적) (줄바꿈)`
      - 상태 코드(status code) : 요청 결과를 나타내는 세 자리 정수
      - 이유 구문(reason phrase) : 상태 코드에 대한 문자열 형태의 설명
  - 필드 라인, 헤더 라인
    - HTTP 헤더(HTTP header) : `헤더 이름(header-name):헤더 값(header-value)`
    - HTTP 통신에 필요한 부가 정보
  - 메시지 본문(message-body)
- HTTP 메서드
  - GET : 특정 자원 조회
    - 요청 : 요청 대상 + Host 헤더
    - 응답 : 요청한 자원
    - 요청에 메시지 본문(message-body) 미포함
  - HEAD : GET 메서드와 동일하나, 응답에 메시지 본문 없음
  - POST : 서버에 작업 요청
    - 서버에 새로운 자원을 생성하는 경우
    - 응답에 Location 헤더 포함(생성된 자원의 위치)
  - PUT : 요청 자원이 없다면 메시지 본문으로 새롭게 생성, 있으면 메시지 본문으로 대체
  - PATCH : 부분적 수정
  - DELETE : 특정 자원 삭제
  - API 문서 : URL 요청에 대한 서버의 응답 문서
- HTTP 상태 코드 (응답 메시지)
  - 200번대 : 성공 상태 코드
    - 200 OK : 요청 성공
    - 201 Created : 요청 성공, 새로운 자원 생성
    - 202 Accepted : 요청 수신 완료, 요청 작업 미완료 (요청 결과 곧바로 응답하지 못하는 상황)
    - 204 No Content : 요청 성공, 메시지 본문으로 표시할 데이터 없음
  - 300번대 : 리다이렉션(redirection)
    - 리다이렉션 : 클라이언트의 요청을 다른 곳(URL 또는 캐시)으로 이동시키는 것
      - 영구적 리다이렉션(permanent redirection) : 자원 완전 이동, 경로 재지정
      - 일시적 리다이렉션(temporary redirection) : 자원 위치 임시 변경 또는 임시 사용 URL 이 필요한 경우
    - 301 Moved Permanently : 영구적 리다이렉션. 메서드 변경될 수 있음
    - 308 Permanent Redirect : 영구적 리다이렉션. 메서드 변경되지 않음(301보다 명시적)
    - 302 Found : 일시적 리다이렉션. 메서드 변경될 수 있음
    - 303 See Other : 일시적 리다이렉션. 메서드 GET 으로 변경
    - 307 Temporary Redirect : 일시적 리다이렉션. 메서드 변경되지 않음(302보다 명시적)
  - 400번대 : 클라이언트 에러
    - 400 Bad Request : 클라이언트의 요청이 잘못된 경우
    - 401 Unauthorized : 요청한 자원에 대한 유효한 인증이 없음
    - 403 Forbidden : 요청이 서버에 의해 거부됨(접근 권한이 없는 경우. 인가)
      - 인증(authentication) : 자신이 누구인지 증명하는 것 
      - 인가(authorization) : 인증된 주체에 작업을 허용하는 것(권한 부여)
    - 404 Not Found : 요청 자원을 찾을 수 없음
    - 405 Method Not Allowed : 요청 메서드를 지원하지 않음
  - 500번대 : 서버 에러
    - 500 Internal Server Error : 요청을 처리할 수 없음
    - 502 Bad Gateway : 중간 서버의 통신 오류
    - 503 Service Unavailable : 현재 요청 처리 불가능. 추후 사용 가능할 수도 있음
- HTTP 의 역사
  - HTTP/0.9 
    - GET 만 사용 가능
    - 요청 메시지 한 줄
  - HTTP/1.0  
    - HEAD, POST 도입
    - 헤더 지원 시작
    - 지속 연결(persistent connection) 미지원 : 요청 때마다 연결 새로 생성
  - HTTP/1.1
    - 지속 연결 공식 지원
    - 파이프라이닝 지원(응답 수신 전 다음 요청 보내기 가능)
    - 콘텐츠 협상 기능
  - HTTP/2.0
    - 헤더 압축 전송
    - 바이너리 데이터 기반(이전 버전은 텍스트 기반)
    - 서버 푸시(server push) : 클라이언트가 요청하지 않더라도 자원을 미리 전송
    - HOL 블로킹(Head-Of-Line blocking) 완화
      - HOL 블로킹 : 같은 큐에서 첫 번째 패킷의 처리 지연으로 나머지 패킷도 모두 지연되는 문제
      - 멀티플렉싱(multiplexing) : 스트림(stream)을 이용해 데이터 병렬 전송
  - HTTP/3.0
    - UDP 기반 구현된 QUIC(Quick UDP Internet Connection) 프르토콜 기반으로 동작(빠름)

### 05-3. HTTP 헤더와 HTTP 기반 기술 (308p~)

- HTTP 헤더
  - 요청 시 활용되는 HTTP 헤더
    - Host : 요청을 보낼 호스트
      - 도메인 이름 (+ 포트)
      - ex. Host: example.com:1234
    - User-Agent : HTTP 요청을 시작하는 클라이언트 측 프로그램
      - (브라우저 Mozilla 호환 여부)(운영체제 및 아키텍처 정보)(렌더링 엔진 관련 전보)(브라우저와 버전 정보)
      - ex. User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/109.0
    - Referer : 클라이언트가 요청을 보낼 때 머무르고 있던 URL
      - 원래 Referrer 가 맞지만, 초기 개발 당시 오타 그대로 사용
      - ex. Referer: https://example.com
    - Authorization : 클라이언트의 인증 정보
      - Authorization : <type>(인증 타입) <credentials>(인증을 위한 정보)
      - 인코딩(encoding) : 문자를 코드로 변환하는 방법. ex. Base64 (Basic 인증에서 사용)
      - ex. Authorization: Basic bWluY2h1bDoxMjM0
  - 응답 시 활용되는 HTTP 헤더
    - Server : 서버 측의 소프트웨어 관련 정보
      - ex. Server: Apache/2.4.1 (Unix)
    - Allow : 허용된 HTTP 메서드 목록
      - HTTP 상태 코드 405(Method Not Allowed)를 응답하는 경우 사용
      - ex. Allow: POST, OPTIONS
    - Retry-After : 자원을 사용할 수 있는 날짜 또는 시각
      - HTTP 상태 코드 503(Service Unavailable)을 응답하는 경우 사용
      - ex. Retry-After: Fri, 23 Aug 2024 09:00:00 GMT
      - ex. Retry-After: 120
    - Location : 클라이언트에게 자원의 위치를 알려주기 위해 사용
      - 리다이렉션 또는 새로운 자원 생성시
    - WWW-Authenticate : 자원에 접근하기 위한 인증 방식
      - HTTP 상태 코드 401(Unauthorized)을 응답하는 경우 사용
      - ex. WWW-Authenticate: Basic
      - ex. WWW-Authenticate: Basic realm="Access to personal info", charset="UTF-8"
      - 영역(realm) : 보안이 적용된 영역. 영역에 따라 요구되는 권한이 다를 수 있음
  - 요청과 응답 모두에서 활용되는 HTTP 헤더
    - Date : 메시지가 생성된 날짜와 시각
      - ex. Date: Tue, 15 Nov 1994 08:12:31 GMT
    - Connection : 클라이언트의 요청과 응답 간의 연결 방식
      - HTTP 는 지속 연결 프로토콜(keep alive)
      - ex. Connection: keep-alive
      - ex. Connection: close
    - Content-Length : 본문의 바이트 단위 크기(길이)
      - ex. Content-Length: 100
    - 표현 헤더(representation header)
      - Content-Type : 메시지 본문에서 사용될 미디어 타입
        - ex. Content-Type: text/html; charset=UTF-8
      - Content-Language : 메시지 본문에 사용될 자연어
        - `Content-Language: (서브 태그)-(서브 태그)-..`
        - ex. Content-Language: ko
        - ex. Content-Language: en-US
      - Content-Encoding : 메시지 본문을 압축하거나 변환한 방식
        - ex. Content-Encoding: gzip
        - ex. Content-Encoding: deflate, gzip
- 캐시(cache) : 불필요한 대역폭 낭비와 응답 지연을 방지하기 위해 정보의 사본을 임시로 저장하는 기술
  - 개인 전용 캐시(private cache) : 웹 브라우저에 저장된 캐시
  - 공용 캐시(public cache) : 중간 서버에 저장된 캐시
  - 캐시 신선도(cache freshness) : 캐시된 사본 데이터와 최신 원본 데이터의 유사도
    - 캐시 데이터에 유효 기간 부여
      - Expires 헤더
        - ex. Expires: Tue, 06 Feb 2024 12:00:00 GMT
      - Cache-Control 헤더의 Max-Age 값(초)
        - ex. Cache-Control: max-age=1200
    - 캐시의 신선도 검사
      - 날짜 기반
        - If-Modified-Since (이 날짜 이후로 자원 변경이 변경되었는지)
          - ex. If-Modified-Since: Fri, 23 Aug 2024 09:00:00 GMT
        - 서버 응답
          - 자원 변경 있음 : 200(OK) + 새로운 자원
          - 자원 변경 없음 : 304(Not Modified) -> 클라이언트는 캐시 사용
            - Last-Modified(선택) : 자원의 마지막 변경 시점
          - 자원 삭제 : 404(Not Found)
      - 엔티티 태그 기반
        - 엔티티 태그(entity tag, ETag) : 자원의 버전을 식별하기 위한 정보
        - 버전(version) : 유의미한 변경 사항
        - If-None-Match (ETag 값과 일치하는 지원이 있는지)
          - ex. If-None-Match: "abc"
        - 서버 응답
          - ETag 값 변경(자원 변경 있음) : 200(OK) + 새로운 자원
          - ETag 값 동일(자원 변경 없음) : 304(Not Modified)
          - 자원 삭제 : 404(Not Found)
- 쿠키(cookie) : 서버에서 생성되어 클라이언트 측에 저장되는 데이터
  - HTTP 의 stateless 성격을 보완
  - 세션 인증
    - 세션 아이디(session id) : 쿠키를 통해 전달
    - 클라이언트 -> 서버 : 인증 정보 전송
    - 서버 -> 클라이언트 : 세션 아이디 전송
    - 서버 : 세션 아이디 저장(DB 등)
    - 클라이언트 -> 서버 : 쿠키 내부의 세션 아이디 포함하여 요청
    - 서버 : 요청받은 세션 아이디와 저장된 세션 아이디를 비교하여 클라이언트 식별
  - Set-Cookie : 응답 메시지 헤더. 쿠키에 저장된 값 전달
    - `Set-Cookie: 이름=값; 속성; ..`
    - ex. Set-Cookie: message=hello
    - 속성
      - domain : 쿠키가 사용될 도메인
      - path : 쿠키가 사용될 경로(하위 경로)
      - Expires, Max-Age : 쿠키의 유효 기간
  - Cookie : 요청 메시지 헤더. 서버에 전달할 쿠키
    - `Cookie: 이름=값; 이름=값; ..`
    - ex. Cookie: name=gigyesik, message=hello
  - 쿠키의 한계 : 쉽게 노출되거나 조작될 수 있음(보안)
    - 보완 속성
      - Secure : HTTPS 프로토콜이 사용되는 경우에만 쿠키 전송
      - HttpOnly : 자바스크립트에서 쿠키에 접근 불허용 (HTTP 헤더를 통해서만 가능)
- 웹 스토리지(web storage) : 쿠키 이외의 웹 브라우저 내 저장 공간
  - 쿠키와 달리 서버로 자동 전송되지 않음
  - 로컬 스토리지(local storage) : 영구 저장 가능(별도로 삭제하지 않으면)
  - 세션 스토리지(session storage) : 세션이 유지되는 동안 저장(브라우저가 열려 있는 동안)
- 콘텐츠 협상과 표현
  - 콘텐츠 협상(content negotiation) : 같은 URI 에 대해 가장 적합한 자원의 형태를 제공하는 메커니즘
  - 표현(representation) : 송수신 가능한 자원의 형태
  - GET 메서드 재정의 : 자원 습득 -> 자원의 특정 표현 습득
  - 요청 메시지 헤더
    - Accept : 선호 미디어 타입
    - Accept-Language : 선호 언어
    - Accept-Charset : 선호 문자 인코딩
    - Accept-Encoding : 선호 압축 방식
    - 우선순위 : 헤더의 q값. 생략된 경우 1, 범위 0~1, 클수록 우선순위 높음
    - ex. Accept: text/html, application/xml; q=0.9, text/plain; q=0.6, \*/\*; q=0.5
    - ex. Accept-Language: ko-KR, ko; q=0.9, en-US; q= 0.8, en; q=0.7

## 06. 실습으로 복습하는 네트워크 (332p~)

### 06-1. 와이어샤크 설치 및 사용법 (334p~)

- 와이어샤크(WireShark) : 패킷 캡처 프로그램
- 와이어샤크 설치
  - 윈도우
  - 맥 OS
- 와이어샤크 사용
  - HTTP 패킷 (아래에서부터) 캡슐화
    - HTTP(Hypertext Transfer Protocol)
      - 메서드, Host, Connection 등
    - TCP(Transmission Control Protocol)
      - Source Port, Destination Port, Sequence Number, Acknowledge Number 등 
    - IPv4(Internet Protocol Version 4)
    - 이더넷 프레임(Ethernet II)
      - MAC 주소(Destination, Source), 타입/길이(Type)
- 패킷 필터
  - eth : Ethernet
  - ip : Internet Protocol Version 4(IPv4)
  - ipv6 : Internet Protocol Version 6(IPv6)
  - tcp : Transmission Control Protocol(TCP)
  - udp : User Datagram Protocol(UDP)
  - http : Hypertext Transfer Protocol(HTTP)
  - tls : Transport Layer Security(TLS)
  - 등등

### 06-2. 와이어샤크를 통한 프로토콜 분석 (360p~)

- IP 분석
  - IPv4 단편화 + ICMP (ipv4-fragmentation)
    - 1~7
      - Internet Protocol Version 4(IPv4)
        - Source Address(송신지 IP 주소) : 10.0.0.1
        - Destination Address(수신지 IP 주소) : 10.0.0.2
        - Identification(식별자) : 0x2c2e(11310)
        - 1~6
          - Length(이더넷 프레임 헤더(14) + IP 헤더(20) + 데이터) : 1500 
          - Flags(플래그)
            - MF(more fragment) : 1
            - Fragment Offset(단편화 오프셋) : 0, 1480, 2960, 4440, 5920, 7400
        - 7
          - Length(이더넷 프레임 헤더(14) + IP 헤더(20) + 데이터) : 120
          - Flags(플래그)
            - MF(more fragment) : 0
            - Fragment Offset(단편화 오프셋) : 8880
      - Internet Control Message Protocol(ICMP)
        - 7
          - Type, Code : 8, 0 -> 에코 요청 메시지
    - 8~14 
      - Internet Protocol Version 4(IPv4)
        - Source Address(송신지 IP 주소) : 10.0.0.2
        - Destination Address(수신지 IP 주소) : 10.0.0.1
        - Identification(식별자) : 0x2aad(10925)
        - 14
          - Flags(플래그)
            - MF(more fragment) : 0 
      - Internet Control Message Protocol(ICMP)
        - 14
          - Type, Code : 0, 0 -> 에코 응답 메시지
  - IPv6 단편화 + ICMP (ipv6-fragmentation)
    - 1~2
      - Internet Protocol Version 6(IPv6)
        - Source Address : 20f4:c750:2f42:53df::11:0
          - 20f4:c750:2f42:53df:0000:0000:0011:0000
        - Destination Address : 26f7:f750:2ffb:53df::1001
          - 26f7:f750:2ffb:53df:0000:0000:0000:1001
        - Next Header : UDP(17) -> 캡슐화(단편화되지 않음)
      - User Datagram Protocol(UDP)
        - Source Port : 58677
        - Destination Port : 58677
        - Length : 126, 39
    - 3~6
      - Internet Protocol Version 6(IPv6)
        - Source Address : 26f7:f750:2ffb:53df::1001
        - Destination Address : 20f4:c750:2f42:53df::11:0
        - Next Header : Fragment Header for IPv6(44) -> 단편화됨
          - Fragment Header For IPv6
            - Next Header : UDP(17) -> 캡슐화
            - Identification : 0xf88eb466
            - Offset : 0, 181, 362, 543
      - User Datagram Protocol(UDP)
        - 6
          - Source Port : 58677
          - Destination Port : 58677
          - Length : 1456
- TCP 분석
  - TCP 연결 수립 (3-way-handshake)
    - SYN (1)
      - Source : 192.168.0.1:49859 (dynamic port)
      - Destination : 10.10.10.1:80 (well-known port)
      - Sequence Number : 3588415412
      - Flags
        - SYN : 1
      - Options
        - MSS(Maximum Segment Size) : 1460 bytes
        - SACK(Selective ACK) : permitted
    - SYN, ACK (2)
      - Source : 10.10.10.1:80 (well-known port)
      - Destination : 192.168.0.1:49859 (dynamic port)
      - Sequence Number : 697411256
      - Acknowledgement Number : 3588415413
      - Flags
        - SYN : 1
        - Acknowledgement : 1
    - ACK (3)
      - Source : 192.168.0.1:49859 (dynamic port)
      - Destination : 10.10.10.1:80 (well-known port)
      - Sequence Number : 3588415413
      - Acknowledgement Number : 697411257
  - TCP 연결 종료 (connection-close)
    - FIN (1)
      - Source : 10.10.10.1:80
      - Destination : 192.168.0.1:3372
      - Flags
        - Fin : 1
    - ACK (2)
      - Source : 192.168.0.1:3372
      - Destination : 10.10.10.1:80
      - Flags
        - Acknowledgement : 1
    - FIN (3)
      - Source : 192.168.0.1:3372
      - Destination : 10.10.10.1:80
      - Flags
        - Fin : 1
    - ACK (4)
      - Source : 10.10.10.1:80
      - Destination : 192.168.0.1:3372
      - Flags
        - Acknowledgement : 1
  - TCP 재전송 (tcp-retransmission)
    - 1 (성공)
      - Source : 10.10.10.1:80
      - Destination : 192.168.0.1:54436
      - Sequence Number : 2530489553
      - Acknowledgement Number : `3714426508`
    - 2 (유실)
      - Source : 192.168.0.1:54436
      - Destination : 10.10.10.1:80
      - Sequence Number : `3714426508`
      - Acknowledgement Number : `2530491013`
    - 3 (중복 ACK. 유실되지 않았다면 2번 패킷의 Acknowledgement Number 를 알고 있어야 함)
      - Source : 10.10.10.1:80
      - Destination : 192.168.0.1:54436
      - Sequence Number : 2530504153
      - Acknowledgement Number = `3714426508`
    - 4 (중복 1)
      - Source : 192.168.0.1:54436
      - Destination : 10.10.10.1:80
      - Sequence Number : 3714426508
      - Acknowledgement Number : `2530491013`
    - 5 (중복 ACK)
      - Source : 10.10.10.1:80
      - Destination : 192.168.0.1:54436
      - Sequence Number : 2530505613
      - Acknowledgement Number : `3714426508`
    - 6 (중복 2)
      - Source : 192.168.0.1:54436
      - Destination : 10.10.10.1:80
      - Sequence Number : 3714426508
      - Acknowledgement Number : `2530491013`
    - 7 (중복 ACK)
      - Source : 10.10.10.1:80
      - Destination : 192.168.0.1:54436
      - Sequence Number : 2530507073
      - Acknowledgement Number : `3714426508`
    - 8 (중복 3)
      - Source : 192.168.0.1:54436
      - Destination : 10.10.10.1:80
      - Sequence Number : 3714426508
      - Acknowledgement Number : `2530491013`
    - 9 (중복 3번 일어났으므로 빠른 재전송, 빠른 회복)
      - Source : 10.10.10.1:80
      - Destination : 192.168.0.1:54436
      - Sequence Number : `2530491013`
      - Acknowledgement Number : 3714426508
- HTTP 분석 (http-request-response)
  - Hypertext Transfer Protocol
    - 1 (요청)
      - Request Method : GET
      - Request URI : /
      - Host : info.cern.ch\r\n
        - \r\n : 캐리지 리턴(Carriage Return. 오른쪽 이동 -> \r) + 라인 피드(Line Feed. 줄바꿈 -> \n)
    - 2 (응답)
      - Status Code : 200
      - Content-Type : text/html\r\n
      - Line-based text data : html 문서의 내용
    - 3 (요청)
      - Request Method : GET
      - Request URI : /hypertext/WWW/TheProject.html
        - Referer : http://info.cern.ch/\r\n
    - 5 (응답)
      - Status Code : 200
      - Content-Type : text/html\r\n

## 07. 네트워크 심화 (380p~)

### 07-1. 안정성을 위한 기술 (382p~)

- 가용성(availability)
  - 안정성 : 특정 기능을 언제든 균일한 성능으로 수행할 수 있는 특성
  - 가용성 : 시스템이 특정 기능을 수행할 수 있는 시간의 비율(안정성의 정도)
    - 업타임(uptime) : 정상 사용 시간
    - 다운타임(downtime) : 정상 사용 불가능 시간
    - 가용성 = (업타임) / (업타임 + 다운타임)
  - 고가용성(High Availability; HA)
    - 99.999% (five nines) : 1년간 다운타임 5.26분
  - 결함 감내(fault tolerance) : 문제가 발생하더라도 기능할 수 있는 능력
- 이중화
  - 이중화 : 이중으로 두는 기술 -> 백업 마련
  - 백업 대상 : SPoF
  - 단일 장애점(SPoF; Single Point of Failure) : 문제가 발생할 경우 시스템 전체가 중단될 수 있는 대상
  - 이중화 구성
    - 액티브/스탠바이(active-standby) : 한 시스템 가동, 다른 시스템 대기
      - 페일오버(failover) : 액티브 시스템에 문제가 생기는 경우 스탠바이 시스템으로 자동 전환되는 기술
    - 액티브/액티브(active-active) : 두 시스템 모두 가동
  - 다중화 : 여러 개 두는 기술 (이중화 확장)
    - 티밍(teaming, Windows), 본딩(bonding, Linux) : 여러 NIC 를 다중화하여 하나의 인터페이스처럼 보이게 하는 기술
      - 1Gbps NIC 3개를 액티브/액티브로 티밍하면 3Gbps 성능의 인터페이스 하나로 사용 가능
- 로드 밸런싱
  - 트래픽
    - 주어진 시점에 네트워크를 경유한 데이터의 양
    - 더 일반적 표현 : 주어진 시점에 특정 노드를 경유한 패킷의 양
  - 로드 밸런싱(load balancing) : 트래픽의 고른 분배를 위해 사용하는 기술
    - L4, L7 스위치
    - 소프트웨어(HAProxy, Envoy, Nginx 등)
  - 헬스 체크(health check) : 현재 요청에 대해 올바른 응답을 할 수 있는 상태인지 검사(로드 밸런서가 수행)
    - cf. 하트비트(heartbeat) : 서버 간에 상태 체크
  - 로드 밸런싱 알고리즘
    - 라운드 로빈(round robin) : 순차적으로 부하 전달
      - 가중치 라운드 로빈(weighted round robin) : 가중치 n인 곳에 n배의 부하 전달
    - 최소 연결(least connection) : 연결이 적은 서버부터 우선적으로 부하 전달
      - 가중치 최소 연결(weighted least connection) : 가중치 n인 곳에 n배의 부하 전달
- 프록시(proxy)
  - 오리진 서버(origin server) : 흔히 알고 있는 서버
    - 자원을 생성하고 클라이언트에게 권한 있는 응답을 보낼 수 있는 HTTP 서버
    - 인바운드(inbound) 메시지 : 오리진 서버를 향하는 메시지
    - 아웃바운드(outbound) 메시지 : 클라이언트를 향하는 메시지
  - 중간 서버(프록시, 게이트웨이)
    - 프록시(proxy) : 포워드 프록시(forward proxy)
      - 클라이언트가 '선택한' 메시지 대리자 (클라이언트 쪽에 가까움)
      - 캐시 저장, 클라이언트 암호화 및 접근 제한 기능
    - 게이트웨이(gateway) : 리버스 프록시(reverse proxy)
      - 아웃바운드에 대해 오리진 서버 역할, 수신 요청을 변환하여 인바운드 서버에 전달 (서버 쪽에 가까움)
      - 캐시 저장, 로드 밸런서로 동작 가능

### 07-2. 안전성을 위한 기술 (394p~)

- 암호와 인증서
  - 암호화(encryption) : 원문 데이터를 알아볼 수 없는 형태로 변경하는 것
  - 복호화(decryption) : 암호화된 데이터를 원문 데이터로 되돌리는 과정
  - 대칭 키 암호화(symmetric key cryptography)
    - 암호화와 복호화에 동일한 키 사용
    - 키 유출시 보안 상실
  - 공개 키 암호화(public key cryptography), 비대칭 키 암호화(asymmetric key cryptography)
    - 공개 키(public key) : 암호화를 위한 키. 유출 가능
    - 개인 키(private key) : 복호화를 위한 키. 유출 안됨
    - 과정 (호스트 A -> B)
      - A -> B : 공개 키 요청
      - B -> A : 공개 키 응답
      - A -> B : 공개 키로 암호화한 데이터 전달
      - B : 개인 키로 복호화한 데이터 확인
    - 대칭 키 암호화에 비해 부하가 큼
  - 세션 키(session key) 암호화 : 대칭 키 + 공개 키
    - 공개 키로 대칭 키를 암호화
    - 개인 키로 암호화된 대칭 키 복호화
    - 대칭 키 안전하게 공유 + 대칭 키를 빠르게 암호화/복호화
  - 인증서와 디지털 서명
    - 공개 키 인증서(public key certificate) : 공개 키와 공개 키의 유효성을 입증하기 위한 문서
      - 서명 값(signature) : 인증 기관의 공개 키에 대한 인증
        - 인증서 내용의 해시 값(지문. fingerprint)을 CA의 개인 키로 암호화
        - 해시 값 : 해시 함수(MD5, SHA-1, SHA-256 등)를 적용시킨 값
    - 인증 기관(CA; Certification Authority) : 인증서 발급 기관
      - IdenTrust, DigiCert, GlobalSign 등
    - 디지털 서명(digital signature) 과정
      - 서버로부터 인증서 + 서명 값 수신
      - 인증서와 서명 값 분리 -> 인증서 + 서명 값
      - 서명 값은 '개인 키'로 암호화 했으므로 CA의 '공개 키'로 복호화 가능 -> 인증서 내용 해시 값
      - 인증서에 해시 함수 적용 -> 인증서 내용 해시 값
      - 두 값 비교 -> 일치한다면 공개 키 유효성 입증
- HTTPS: SSL 과 TLS
  - SSL : Secure Socket Layer. 인증서 암호화 수행
  - TLS : Transport Layer Security. SSL 계승
  - HTTPS(HTTP over TLS) : SSL/TLS 사용 프로토콜. HTTP 메시지에 보안 적용
    - TCP three-way handshake
      - SYN, SYN + ACK, ACK
    - TLS handshake
      - 클라이언트 -> 서버
        - ClientHello
          - 지원되는 TLS 버전
          - 암호 스위트(cipher suite) : 사용 가능한 암호화 방식과 해시 함수
            - ex. TLS_AES(알고리즘)_128_GCM_SHA256(해시 함수)
          - 키를 만들기 위해 사용할 클라이언트의 난수
      - 서버 -> 클라이언트 
        - ServerHello
          - 선택된 TLS 버전
          - 암호 스위트
          - 키를 만들기 위해 사용할 서버의 난수
        - Certificate : 인증서
        - CertificateVerify : 디지털 서명
        - Finished
        - Application Data (TLS 1.3)
      - 클라이언트 -> 서버
        - Finished
        - Application Data (TLS 1.3)
    - 암호화된 메시지 송수신 (Application Data)

### 07-3. 무선 네트워크 (408p~)

- 전파와 주파수
  - 전파(radio wave) : 3kHz ~ 3THz 사이의 진동수를 갖는 전자기파
  - 통신에 사용되는 전파에는 주파수 대역이 정해져 있음(국가마다 다름)
- 와이파이와 802.11
  - IEEE 802.11 : LAN 환경에서의 무선 통신 표준
    - 주파수 대역
      - 2.4GHz : 더 느리고 간섭 덜함
      - 5GHz : 더 빠르고 간섭 더함
      - 채널(channel) : 하위 주파수 대역(간섭 방지)
    - 변조(modulation) : 정보를 원하는 형태의 신호로 변환하는 것
    - 복조(demodulation) : 변조된 신호를 원래의 정보로 다시 변환하는 것
  - 와이파이(Wi-Fi)
    - Wi-Fi Alliance 라는 비영리 단체의 브랜드 이름
    - IEEE 802.11 표준을 준수하는 무선 LAN 기술
- AP 와 서비스 셋
  - AP(Access Point) : 무선 통신 기기들을 연결하여 무선 네트워크를 구성하는 장치
  - 인프라스트럭처 모드(infrastructure mode) : AP 를 경유하여 통신이 이루어지는 무선 네트워크 통신 방식
    - cf. 애드 혹 모드(Ad Hoc mode) : AP 간섭 없이 호스트 간 일대일로 무선 통신하는 모드
  - 서비스 셋(Service Set) : 무선 네트워크를 이루는 AP 와 여러 장치들의 집합
    - 서비스 셋 식별자(SSID; Service Set Identifier) : 서비스 셋 구분자. 와이파이 무선 네트워크(AP) 이름
    - BSS(Basic Service Set) : 하나의 AP 로 구성된 무선 LAN
    - ESS(Extended Service Set) : 여러 AP 로 구성된 무선 LAN
    - 비컨 프레임(beacon frame) : AP 가 자신을 주기적으로 알리는 브로트캐스트 메시지
