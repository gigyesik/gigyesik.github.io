# AWS 교과서

## 1장. AWS 란 (17p~)

### 1.1 클라우드 컴퓨팅 (18p~)

- 1.1.1. 클라우드 컴퓨팅이란
  - 온프레미스(on-premises) : 사용자가 공간, 자원 등을 자체적으로 구축, 운영하는 방식
  - 온디맨드(on-demand) : 인터넷을 통해 요구가 있을 때 IT 자원이 제공되는 방식
  - 클라우드(cloud) : 인터넷 구간 어딘가에 구성된 IT 자원 집합
  - 클라우드 컴퓨팅(cloud computing) : 클라우드 환경에서 온디맨드로 제공하는 서비스
- 1.1.2. 클라우드 컴퓨팅의 이점
  - 민첩성 : 필요한 자원을 빠르게 구동 가능
  - 탄력성 : 필요한 만큼의 자원만 할당받아 사용 가능
  - 비용 절감 : IT 자원을 사용한 만큼 비용 지불
- 1.1.3. 클라우드 컴퓨팅 서비스 유형(as-a service)
  - IaaS
    - Infrastructure as a Service
    - 클라우드 공급자는 인프라 영역 관리
      - 서버/스토리지/네트워킹 + 가상화
    - 클라우드 사용자는 나머지 영역 관리
      - 운영체제 + 미들웨어 + 런타임 + 데이터 + 어플리케이션
  - PaaS
    - Platform as a Service
    - 클라우드 사용자가 어플리케이션 영역만 관리
      - 데이터 + 어플리케이션
    - 클라우드 공급자는 나머지 영역 관리
      - 서버/스토리지/네트워킹 + 가상화 + 운영체제 + 미들웨어 + 런타임
  - SaaS
    - Software as a Service
    - 클라우드 공급자가 모든 것을 제공
      - 서버/스토리지/네트워킹 + 가상화 + 운영체제 + 미들웨어 + 런타임 + 데이터 + 어플리케이션
    - 클라우드 사용자는 서비스만 받음
- 1.1.4. 클라우드 구축 모델
  - 퍼블릭 클라우드(public cloud) 구축 모델
    - 클라우드 공급자가 클라우드 자원 공급
    - AWS(Amazon Web Service), GCP(Google Cloud Platform), Microsoft Azure 등
  - 프라이빗 클라우드(private cloud) 구축 모델
    - 사용자 환경에 온프레미스 환경으로 클라우드 자원 구축
  - 하이브리드 클라우드(hybrid cloud) 구축 모델
    - 퍼블릭 클라우드와 프라이빗 클라우드 혼합

### 1.2. AWS 서비스 (24p~)

- 1.2.1. AWS 소개
  - 리전(region) : 클라우드 서비스를 위해 자원이 모여 있는 물리적 데이터 센터의 지리적 위치(지역)
  - 가용 영역(availability zone) : 리전 내 구성되는 개별 데이터 센터
- 1.2.2. AWS 서비스 라인업
  - AWS 컴퓨팅
    - 서버 자원에 대한 가상 머신 생성, 비용 및 용량 관리
    - Amazon Elastic Compute Cloud(Amazon EC2)
  - AWS 네트워킹 및 콘텐츠 전송
    - 내, 외부 통신 네트워크 서비스
    - Amazon Virtual Private Cloud(VPC)
    - Amazon CloudFront
    - Amazon Route53
  - AWS 스토리지
    - 클라우드에 데이터 저장
    - Amazon Simple Storage Service(S3)
    - Amazon Elastic File System(EFS)
    - Amazon Elastic Block Store(EBS)
  - AWS 데이터베이스
    - 데이터베이스 엔진
    - Amazon Relational Database Service(RDS)
    - Amazon Aurora
    - Amazon DynamoDB
  - AWS 보안 자격 증명 및 규격 준수
    - 사용자 자격 증명 및 관리
    - 데이터, 네트워크, 어플리케이션 보호
    - 위협 탐지 및 모니터링
    - AWS Identity & Access Management(IAM)
- 1.2.3. AWS 과금 체계
  - Pay Per Use : IT 자원을 사용한 만큼 비용 지불
  - 처음 가입시 프리 티어(free-tier) 정책

### 1.3. (실습) AWS 가입하기 - 프리 티어 (27p~)

- 1.3.1. AWS 계정 생성
- 1.3.2. AWS 관리 콘솔
  - AWS 관리 콘솔(management console) : 웹 기반
  - cf. AWS CLI(Command Line Interface) : 셸 프로그램 명령어 기반
  - cf. AWS IaC(Infrastructure as Code) : 코드 기반

## 2장. AWS 컴퓨팅 서비스 (37p~)

### 2.1. AWS 컴퓨팅 서비스 (38p~)

- 2.1.1. 컴퓨팅 정의
  - 컴퓨팅(computing) : 계산하고 답을 구하고 추정하는 행위
  - 서버(server) : 컴퓨팅을 목적으로 특화된 장비(device)
  - 워크로드(workload) : 컴퓨팅 리소스의 처리 작업
- 2.1.2. AWS 컴퓨팅 서비스
  - AWS 컴퓨팅 서비스 : 퍼블릭 클라우드에서 컴퓨팅 자원을 활용하여 워크로드를 수행하는 서비스
  - EC2(Elastic Compute Cloud) : 클라우드 환경에서 인스턴스(instance) 라는 가상 머신(Virtual Machine; VM) 형태로 서버 자원을 제공
  - ECS(Elastic Container Service) : EC2 기반 클러스터에서 실행되는 컨테이너의 배포, 스케줄링(scheduling), 스케일링(scaling) 서비스
  - Lambda : 서버리스(serverless) 컴퓨팅 서비스
    - 서버리스 : 서버 설정 없이 환경만 제공. 코드만 실행
  - Lightsail : 독립적 환경 제공 컴퓨팅 서비스

### 2.2. Amazon EC2 소개 (39p~)

- Amazon EC2(Amazon Elastic Compute Cloud) : AWS 에서 제공하는 가상 서버
  - Elastic : '탄력적인'. 컴퓨팅 자원을 온디맨드로 사용 가능
  - AMI(Amazon Machine Image) : EC2 에서 필요한 소프트웨어 정보 정의
- 2.2.1. Amazon EC2 인스턴스
  - 인스턴스 유형 (t2.micro)
    - t : 인스턴스 패밀리. 용도별 분류
    - 2 : 인스턴스 세대. 높을수록 최신 세대(성능 우수)
    - micro : 인스턴스 크기. 클수록 용량과 가격 증가
  - 인스턴스 상태
    - 인스턴스 시작 : 대기 중(pending) -> 실행 중(running)
    - 실행 중인 인스턴스 중지 : 실행 중 -> 중지 중(stopping) -> 중지됨(stopped)
    - 중지된 인스턴스 시작 : 중지됨 -> 대기 중 -> 실행 중(running)
    - 중지된 인스턴스 종료 : 중지됨 -> 종료 중(shutting-down) -> 종료됨(terminated)
    - 실행 중인 인스턴스 종료 : 실행 중 -> 종료 중 -> 종료됨
- 2.2.2. AMI
  - AMI : 인스턴스 시작시 운영 체제와 소프트웨어 구성을 제공하는 템플릿
- 2.2.3. Amazon EC2 스토리지
  - 스토리지(storage) : 데이터 저장 공간
    - 인스턴스 스토어(instance store)
      - 인스턴스에 바로 붙어 있는 저장소(기본 생성. 임시 저장소)
      - 빠른 I/O(Input/Output)
      - 인스턴스 중지 또는 종료시 저장된 데이터 모두 손실
    - Amazon EBS(Elastic Block Store)
      - 네트워킹을 통해 인스턴스와 EBS 연결된 구조
- 2.2.4. Amazon EC2 네트워킹
  - Amazon VPC(Virtual Private Cloud) : 가상의 클라우드 네트워크 
    - EC2 인스턴스는 VPC 내부에 생성되어 네트워킹
  - ENI(Elastic Network Interface) : 네트워크 인터페이스
    - VPC 내 생성되는 가상의 네트워크 어댑터
  - IP(Internet Protocol) 주소
    - 공인 IP(public IP) : 외부 구간의 통신을 위한 IP
    - 사설 IP(private IP) : 내부 구간의 통신을 위한 IP
- 2.2.5. Amazon EC2 보안
  - 보안 그룹(security group) : 가상의 방화벽
    - 인바운드(inbound) : 인스턴스 기준으로 수신 트래픽 규칙
    - 아웃바운드(outbound) : 인스턴스 기준으로 송신 트래픽 규칙
  - 키 페어(key pair) : 인스턴스에 연결할 때 자격을 증명하는 보안 키
    - 퍼블릭 키(public key) : 인스턴스에 저장
    - 프라이빗 키(private) : 사용자 컴퓨터에 저장
- 2.2.6. Amazon EC2 모니터링
  - 수동 모니터링 도구
    - Amazon EC2 대시보드
    - Amazon CloudWatch
  - 자동 모니터링 도구
    - Amazon CloudWatch
    - Amazon SNS(Simple Notification Service)
- 2.2.7. Amazon EC2 구입 옵션
  - 온디맨드 인스턴스 : 시작하는 인스턴스 비용을 초 단위로 지불
  - Saving Plans : 1년 또는 3년 동안 시간당 비용 약정(일관된 컴퓨팅 사용량)
  - 예약 인스턴스 : 1년 또는 3년 동안 인스턴스 유형과 리전 약정(일관된 인스턴스)
  - 스팟 인스턴스 : 미사용 중인 인스턴스에 대해 경매 방식으로 할당

### 2.3. (실습) Amazon EC2 인스턴스 배포 및 접근하기 (50p~)

- 준비 : SSH(Secure SHell)
- EC2 키 페어 내려받기 : EC2 -> 네트워크 및 보안 -> 키 페어 -> 키 페어 생성
- 2.3.1. AMI 를 이용한 EC2 인스턴스 배포하기
  - EC2 대시보드 -> 인스턴스 시작
  - AMI : Amazon Linux 2 AMI (HVM)
  - 인스턴스 유형 : t2.micro
  - 키 페어 : 위에서 생성한 키 페어
  - 네트워크 설정 : 기본 보안 그룹(default)
  - 스토리지 구성 : 8GiB gp2
- 2.3.2. SSH 로 EC2 인스턴스에 접속하여 웹 서비스 설정하기
  - SSH 접속
    - 터미널 -> 키 페어 파일 폴더로 이동
    - `ssh -i [키 이름] ec2-user@[public IP]`
    - 주의 : 보안 그룹 인바운드 규칙에 ssh 내 IP 추가
  - 샘플 웹서비스 배포
    - 관리자 권한으로 변경 : `sudo su -`
    - http 데몬 설치 : `yum install httpd -y`
    - http 데몬 실행 : `systemctl start httpd`
    - 웹 서비스 내려받기
- 2.3.3. EC2 인스턴스에 생성된 웹 서비스 접속하기
  - 주의 : 보안 그룹 인바운드 규칙에 http 내 IP 추가
  - 브라우저에서 public ip 주소로 접속
- 2.3.4. EC2 인스턴스의 모니터링 설정하기
  - 수동 모니터링
    - EC2 -> 모니터링 탭
    - EC2 -> 모니터링 -> 대시보드에 추가 -> 새 대시보드 생성 -> CloudWatch 대시보드 생성
  - 자동 모니터링
    - EC2 -> 모니터링 탭 -> 세부 모니터링 관리 -> 활성화 체크 -> 저장
    - CloudWatch -> 경보 생성 -> 지표 선택 -> 그래프로 표시된 지표
      - ec2 이름 / 'CPUUtilization' 지표 선택
      - 그래프로 표시된 옵션 탭 -> 기간 '1분'
      - 옵션 탭 -> 위젯 유형 '누적 면적' -> 지표 선택
      - 조건
        - 임계값 유형 : 정적
        - 경보 조건 : 보다 큼
        - ...보다 : 50
        - 추가 구성 -> 누락된 데이터 처리 : 누락된 데이터를 양호(임계값 위반 안 함)(으)로 처리
      - 작업 구성
        - 경보 상태 트리거 : 경보 상태
        - SNS 주제 선택 : 새 주제 생성
          - 새 주제 생성 : EC2_CPU_High_Alarm
        - 알림을 수신할 이메일 엔드포인트 : gigyesik@gmail.com
        - EC2 작업
          - 경보 상태 트리거 : 경보 상태
          - 다음 작업 수행 : 이 인스턴스 재부팅
      - 이름 및 설명 추가 -> 경보 이름 : ec2_test_CPU_High_Alarm
    - EC2 에 부하 발생시키기
      - 부하 설정 툴 설치
        - `amazon-linux-extras install -y epel`
        - `yum install -y stress-ng`
      - 부하 70% 발생
        - `stress-ng --cpu 1 --cpu-load 70% --timeout 10m --metrics --times --verify`
    - 메일 전송 후 재부팅됨
- 2.3.5. (번외) 리눅스 명령어를 사용하여 EC2 인스턴스 정보 확인하기
  - CPU 정보 확인 : `cat /proc/cpuinfo | grep name`
  - 메모리 용량 확인 : `cat /proc/meminfo | grep MemTotal`
  - 프라이빗 IP 주소 확인 : `ip -br -c addr show eth0`
  - 퍼블릭 IP 주소 확인 : `curl ipinfo.ip/ip`
  - 스토리지 확인(EBS 볼륨) : `lsblk`, `df -hT -t xfs`
- 2.3.6 실습을 위해 생성된 모든 자원 삭제하기
  - EC2 -> 인스턴스 -> 인스턴스 종료
  - CloudWatch -> 모든 경보 -> 작업 -> 삭제

## 3장. AWS 네트워킹 서비스 (71p~)

### 3.1. 네트워킹이란 (72p~)

- 3.1.1. 네트워킹 정의
  - 네트워킹(networking) : IT 자원간 연결하여 통신하는 환경
- 3.2.2. 네트워킹 요소
  - OSI 7계층
    - 1계층 
      - 물리 계층(physical layer)
      - ex. 1000BASE-TX
    - 2계층
      - 데이터링크 계층(data link layer)
      - ex. Ethernet, MAC
    - 3계층
      - 네트워크 계층(network layer)
      - ex. IP, ICMP
    - 4계층
      - 전송 계층(transport layer)
      - ex. TCP, UDP
    - 5계층
      - 세션 계층(session layer)
      - ex. SSL, TLS
    - 6계층
      - 표현 계층(presentation layer)
      - ex. ASCII, JPG
    - 7계층
      - 응용 계층(application layer)
      - ex. HTTP, SSH, DNT, FTP
  - IP 주소와 서브넷
    - IP(Internet Protocol) 주소 : 인터넷상에서 IP 자원을 식별하는 고유한 주소
      - 퍼블릭 IP 주소 : 인터넷 서비스 공급자(ISP) 에서 제공하는 공인 IP 주소
      - 프라이빗 IP 주소 : 독립된 네트워크 내부에서만 사용하는 네트워크 관리자가 제공하는 사설 IP 주소
        - 클래스 A : 10.0.0.0 ~ 10.255.255.255
        - 클래스 B : 172.16.0.0 ~  172.31.255.255
        - 클래스 C : 192.168.0.0 ~ 192.168.255.255
      - 고정 IP 주소 : 네트워크 관리자가 수동으로 할당
      - 유동 IP 주소 : IP 주소 범위에 따라 동적으로 할당
        - DHCP(Dynamic Host Configuration Protocol) 를 통해 임대하는 방식으로 할당
    - 서브넷(subnet) : 부분 네트워크
      - 서브넷 마스크(subnet mask) : 서브넷 식별값
        - 1은 네트워크 영역, 0은 호스트 영역 (255.255.255.0)
      - IP CIDR(Classless Inter Domain Routing) : IP 주소 + 네트워크 ID 비트 수
        - ex. 10.1.0.0/16
  - 라우팅과 라우터
    - 라우팅(routing) : 네트워킹 시 목적지 경로를 선택하는 작업
    - 라우터(router) : 라우팅을 수행하는 장비
  - TCP 와 UDP
    - TCP(Transmission Control Protocol)
      - 연결형 프로토콜
      - 신뢰성 높음, 속도 낮음
      - 혼잡 제어, 흐름 제어
      - HTTP, SSH
    - UDP(User Diagram Protocol)
      - 비연결형 프로토콜
      - 신뢰성 낮음, 속도 빠름
      - 제어 없음
      - DNS, DHCP
    - 포트 번호
      - IANA(Internet Assigned Numbers Authority) 에서 관리
      - well-known port : 0~1023
      - registered port : 1024~49151
      - dynamic port : 49152~65535

### 3.2. AWS 네트워킹 소개 (78p~)

- 3.2.1. AWS 리전 네트워킹 디자인
  - 리전
    - 군집화된(clustering) 데이터 센터의 물리적인 위치
    - 트랜짓 센터(transit center) + 가용 영역(available zone)
  - Intra-AZ 연결 : 데이터 센터 간 연결
  - Inter-AZ 연결 : 가용 영역 간 연결
  - 트랜짓 센터 연결 : 가용 영역과 외부 인터넷 구간 연결
- 3.2.2. AWS 글로벌 네트워크와 엣지 POP
  - 엣지 POP(edge Point Of Presence) : AWS 글로벌 전용망
    - 일반 서비스 : 트랜짓 센터에서 인터넷 구간으로 확산
    - 엣지 POP 서비스 : 트랜짓 센터에서 AWS 백본 네트워크를 통해 POP 경유하여 AWS 글로벌 네트워크로 확산
      - Amazon CloudFront, Amazon Route 53, AWS Shield, AWS Global Accelerator
- 3.2.3. AWS 네트워킹 서비스 소개
  - VPC : 가상 프라이빗 클라우드 네트워크
  - Transit Gateway : VPC 와 온프레미스 네트워크 연결 게이트웨이
  - Route 53 : 관리형 DNS 서비스
  - Global Accelerator : 가용성 및 성능 증대
  - Direct Connect : 온프레미스 환경의 AWS 전용 네트워크와 연결
  - Site-to-Site VPN : 암호화 네트워크(VPN)

### 3.3. Amazon VPC 소개 (82p~)

- Amazon VPC : Virtual Private Cloud
- 3.3.1. Amazon VPC 기본 구성 요소
  - VPC 는 리전당 한 개 이상 존재할 수 있고, 리전에 종속적
  - 서브넷은 VPC 내 일부 네트워크로, 가용 영역에 종속적
    - 퍼블릭 서브넷 : 외부 인터넷 통신 가능
    - 프라이빗 서브넷 : 폐쇄적인 네트워크 영역
  - IP CIDR : 네트워크에 할당할 IP 주소 표현
    - VPC IP CIDR 내에 서브넷 IP CIDR 이 분할되어 할당됨
  - 가상 라우터와 라우팅 테이블
    - VPC 생성시 기본 라우팅 테이블 존재
    - 별도로 라우팅 테이블 생성하여 서브넷과 연결(attach) 가능
  - 보안 그룹(security group)과 네트워크 ACL(Access Control List)
    - 방화벽(firewall). 서브넷의 트래픽 자원 보호
    - 트래픽 접근 제어 대상
      - 보안 그룹 : 인스턴스와 같은 자원 접근 제어
      - 네트워크 ACL : 서브넷 접근 제어
    - stateful, stateless
      - 보안 그룹 : 이전 상태 정보 기억(stateful)
        - 인바운드 트래픽을 허용한 경우 아웃바운드 규칙에 관계없이 접근 허용
      - 네트워크 ACL : 상태 정보 기억하지 않음(stateless)
        - 인바운드 트래픽을 허용했어도 아웃바운드 규칙 판단
    - 허용 및 거부 정책
      - 보안 그룹 : 허용 규칙에 해당하지 않으면 자동 거부
      - 네트워크 ACL : 허용 규칙과 거부 규칙 모두 판단
- 3.3.2. Amazon VPC 와 다른 네트워크 연결
  - 인터넷 게이트웨이 : 외부 인터넷과 통신
    - 인터넷 게이트웨이 생성 후 VPC 와 연결
    - 서브넷 라우팅 테이블의 타깃 대상을 인터넷 게이트웨이로 지정
  - NAT 게이트웨이(Network Address Translation gateway)
    - 프라이빗 서브넷과 외부 인터넷 통신
    - 프라이빗 IP 주소를 퍼블릭 IP 주소로 변환
    - 퍼블릭 서브넷에 위치
  - VPC 피어링
    - 서로 다른 VPC 연결
    - IP CIDR 중복되면 연결 불가능
  - 전송 게이트웨이(transit gateway)
    - 다수의 VPC 나 온프레미스를 단일 지점으로 연결
  - 가상 프라이빗 게이트웨이(virtual private gateway)
    - AWS Site-to-Site VPN 또는 AWS Direct Connect 연결
- 3.3.3. Amazon VPC 요금
  - 2024년 2월부터 모든 퍼블릭 IP 할당시 유료

### 3.4. (실습) Amazon VPC 로 퍼블릭 및 프라이빗 서브넷 구성하기 (92p~)

- 3.4.1. 사용자 VPC 생성하기 (94p~)
  - VPC 대시보드에 진입하면 기본 VPC(default VPC) 생성되어 있음
  - 사용자 VPC(custom VPC) 생성
    - 생성할 리소스 : VPC 만
    - 이름 태그 : CH3-VPC
    - IPv4 CIDR 블록 : IPv4 CIDR 수동 입력
      - IPv4 CIDR : `10.3.0.0/16`
  - VPC 세부 정보
    - VPC ID : 고유값. 자동 생성
    - 상태 : Available
    - 기본 라우팅 테이블 : 자동 생성
      - 10.3.0.0/16 대상 : local (라우팅 테이블 존재 위치)
    - 기본 네트워크 ACL : 자동 생성
      - 인바운드 규칙, 아웃바운드 규칙 : 모든 IP(0.0.0.0/0) 허용이 최상위 규칙(리스트 순회)
    - 기본 VPC : 아니오 (사용자 VPC)
    - IPv4 CIDR : 10.3.0.0/16
  - 현재 네트워크 구성
    - VPC (10.3.0.0/16)
    - 기본 라우팅 테이블
      - 10.3.0.0/16 local
    - 가상 라우터
    - 기본 네트워크 ACL
- 3.4.2. 퍼블릭 서브넷 생성하기 (98p~)
  - 서브넷 생성하기
    - VPC-ID : CH3-VPC
    - 서브넷 설정
      - 서브넷 이름 : CH3-Public-Subnet
      - 가용 영역 : 아시아 태평양(서울) / ap-northeast-2a
      - IPv4 서브넷 CIDR 블록 : 10.3.1.0/24
  - 서브넷 정보
    - IPv4 CIDR : 10.3.1.0/24
    - 가용 영역 : ap-northeast-2a
    - VPC : CH3-VPC
    - 라우팅 테이블 : 기본 라우팅 테이블 (VPC 와 같음)
  - 라우팅 테이블 생성하기
    - 이름 : CH3-Public-RT
    - VPC : CH3-VPC
    - 라우팅 상세 정보 -> 서브넷 연결 탭 -> 서브넷 연결 편집 -> CH3-Public-Subnet 선택
  - 인터넷 게이트웨이 생성하기
    - 이름 : CH3-IGW
    - 현재 상태 : Detached
    - 작업 -> VPC 에 연결 -> CH3-VPC 에 연결 (상태 Attached 로 변경)
  - 라우팅 테이블 편집하기
    - 라우팅 테이블 정보 -> 작업 -> 라우팅 편집
      - 대상 : 0.0.0.0/0 (전체 트래픽)
      - 대상 : CH3-IGW
  - 현재 네트워크 구성
    - VPC (10.3.0.0/16)
    - 퍼블릭 서브넷 (10.3.1.0/24)
    - 퍼블릭 라우팅 테이블
      - 10.3.0.0/16 local
      - 0.0.0.0/0 CH3-IGW
    - 가상 라우터
    - 기본 라우팅 테이블
    - 인터넷 게이트웨이
- 3.4.3. 퍼블릭 서브넷 통신 확인하기 (109p~)
  - 보안 그룹 생성하기
    - 기본 세부 정보
      - 보안 그룹 이름 : MY-WEB-SSH-SG
      - 설명 : 임의
      - VPC : CH3-VPC
    - 인바운드 규칙
      - HTTP, 내 IP
      - SSH, 내 IP
    - 아웃바운드 규칙
      - 모든 트래픽, 0.0.0.0/0
  - EC2 인스턴스 생성
    - 이름 : CH3-Public-EC2
    - 키 페어(로그인) : test-gigyesik
    - 네트워크 설정 -> 편집
      - VPC : CH3-VPC
      - 서브넷 : CH3-Public-Subnet
      - 퍼블릭 IP 자동 할당 : 활성화
      - 방화벽(보안 그룹) : 기존 보안 그룹 선택 -> MY-WEB-SSH-SG
  - EC2 정보 확인 (네트워킹 탭)
    - 퍼블릭 IPv4 주소
    - 프라이빗 IPv4 주소
    - VPC ID : CH3-VPC
    - 서브넷 ID : CH3-Public-Subnet
    - 가용 영역 : ap-northeast-2a
  - EC2 실습 환경 설정하기 (ssh 연결)
    - `ssh -i [키 파일 이름] ec2-user@[public IP]`
  - EC2 인스턴스에서 외부 인터넷으로 통신 확인하기 
    - ping : `ping google.com` -> 성공
    - http : `curl google.com` -> 성공
  - 외부 인터넷에서 EC2 인스턴스 통신 확인하기
    - PC 에서 웹 접근 -> 성공
    - PC 에서 ping 시도 -> 실패 (http 만 허용)
    - 스마트폰에서 웹 접근 -> 실패 (IP 다름)
    - 스마트폰에서 PC와 같은 와이파이 접속 후 접근 -> 성공
- 3.4.4. 프라이빗 서브넷 생성하기 (116p~)
  - 서브넷 생성하기
    - VPC : CH3-VPC
    - 서브넷 설정
      - 이름 : CH3-Private-Subnet
      - 가용 영역 : 아시아 태평양(서울) / ap-northeast-2c
      - IPv4 서브넷 CIDR 블록 : 10.3.2.0/24
  - 라우팅 테이블 생성하기
    - 이름 : CH3-Private-RT
    - VPC : CH3-VPC
    - 서브넷 연결 편집 -> CH3-Private-Subnet
  - NAT 게이트웨이 생성하기
    - NAT 게이트웨이 설정
      - 이름 : CH3-NAT-GW
      - 서브넷 : CH3-Public-Subnet
      - 연결 유형 : 퍼블릭 (NAT 게이트웨이는 퍼블릭 서브넷 구간에 위치)
      - 탄력적 IP 할당 (공인 IP 고정)
  - 라우팅 테이블 편집하기
    - 라우팅 편집 -> 라우팅 추가
      - 대상 : 0.0.0.0/0
      - 대상 : NAT 게이트웨이 (CH3-NAT-GW)
  - 현재 네트워크 구성
    - VPC (10.3.0.0/16)
    - 퍼블릭 서브넷 (10.3.1.0/24)
    - 퍼블릭 라우팅 테이블
      - 10.3.0.0/16 local
      - 0.0.0.0/0 CH3-IGW
    - 퍼블릭 EC2, 보안 그룹
    - NAT 게이트웨이
    - 프라이빗 서브넷 (10.3.2.0/24)
    - 프라이빗 라우팅 테이블
      - 10.3.0.0/16 local
      - 0.0.0.0/0 CH3-NAT-GW
    - 가상 라우터
    - 인터넷 게이트웨이
- 3.4.5. 프라이빗 서브넷 통신 확인하기 (124p~)
  - EC2 인스턴스 생성
    - 이름 : CH3-Private-EC2
    - 키 페어(로그인) : 키 페어 없이 진행(책에는 설정하라고 되어있지만 connection refused)
    - 네트워크 설정 -> 편집
      - VPC : CH3-VPC
      - 서브넷 : CH3-Private-Subnet
      - 퍼블릭 IP 자동 할당 : 비활성화
      - 방화벽(보안 그룹) : 보안 그룹 생성
    - 고급 세부 정보 -> 사용자 데이터
      ```Bash
      #!/bin/bash
      (
      echo "qwe123"
      echo "qwe123"
      ) | passwd --stdin ec2-user
      sed -i "s/^PasswordAuthentication no/PasswordAuthentication yes/g" /etc/ssh/sshd_config
      systemctl restart sshd
      ```
  - 현재 네트워크 구성
    - VPC (10.3.0.0/16)
    - 퍼블릭 서브넷 (10.3.1.0/24)
    - 퍼블릭 라우팅 테이블
      - 10.3.0.0/16 local
      - 0.0.0.0/0 CH3-IGW
    - 퍼블릭 EC2, 보안 그룹
    - NAT 게이트웨이
    - 프라이빗 서브넷 (10.3.2.0/24)
    - 프라이빗 라우팅 테이블
      - 10.3.0.0/16 local
      - 0.0.0.0/0 CH3-NAT-GW
    - 프라이빗 EC2, 보안 그룹
    - 가상 라우터
    - 인터넷 게이트웨이
  - EC2 인스턴스에서 외부 인터넷 통신 확인하기
    - 먼저 퍼블릭 EC2 인스턴스로 ssh 접근
      - `ssh -i (키 파일 이름) ec2-user@(퍼블릭 IP)`
    - 퍼블릭 EC2 에서 프라이빗 EC2 프라이빗 IP 로 접근
      - `ssh ec2-user@(프라이빗 IP)`
    - `ping google.com` -> 성공
    - `curl ipinfo.io/ip` -> 성공
  - 정리
    - 퍼블릭 서브넷 -> 외부 인터넷 : 가능
    - 외부 인터넷 -> 퍼블릭 서브넷 : 가능
    - 프라이빗 서브넷 -> 외부 인터넷 : 가능
    - 외부 인터넷 -> 프라이빗 서브넷 : 불가능
- 3.4.6. 실습을 위해 생성된 모든 자원 삭제하기 (128p~)
  - EC2 종료
  - NAT 게이트웨이 삭제
  - 탄력적 IP 릴리스
  - VPC 삭제 (하위 구성 자동 삭제됨)

## 4장. AWS 부하분산 서비스 (131p~)

### 4.1. Amazon ELB 기능 소개 (132p~)

- 4.1.1. 부하분산이란
  - 부하분산(로드 밸런싱; load balancing) : 클라이언트 요청에 대한 연산을 다수의 서버에 분산 처리하는 기능
  - 고가용성 : 시스템이나 서비스가 지속적으로 작동 가능하도록 하는 기능
  - 내결함성 : 시스템의 일부 구성 요소가 작동하지 않더라도 계속 작동할 수 있도록 하는 기능
- 4.1.2. Amazon ELB 기능
  - ELB(Elastic Load Balancing) : EC2 인스턴스에 들어오는 트래픽을 분산 처리하는 기술
- 4.1.3. Amazon ELB 구성 요소
  - 로드 밸런서 : 트래픽을 대상 그룹의 인스턴스로 분산시켜 어플리케이션의 가용성 유지
  - 대상 그룹 : 로드 밸런서에서 분산할 대상의 집합을 정의
  - 리스너 : 로드 밸런서에게 사용할 포트와 프로토콜 설정
- 4.1.4. Amazon ELB 동작 방식
  - 클라이언트 요청 수신, 리스너 등록
  - 대상 그룹 선택
  - 트래픽 분산
    - 각 대상의 가용성 상태 모니터링, 가용하지 않은 대상 제외
  - 대상 -> 로드 밸런서 -> 클라이언트 응답 반환
  - 로드 밸런서 통신 방식
    - 인터넷 경계 로드 밸런서 : 외부에서 직접 로드 밸런서에 접근
    - 내부 로드 밸런서 : 격리된 네트워크에서 로드 밸런서 사용
- 4.1.5. Amazon ELB 교차 영역 로드 밸런싱
  - 교차 영역 로드 밸런싱(cross-zone load balancing) : 각 대상 그룹의 인스턴스 수량이 불균형한 경우 트래픽을 보정하는 기술
  - 가용 영역과 무관하게 대상 자원의 비율을 고려하여 로드 밸런싱 수행 가능
  - 가용 영역간 통신 비용이 발생할 수 있음
- 4.1.7. Amazon ELB 종류
  - CLB(Classic Load Balancer)
    - 레거시
    - L4, L7 로드 밸런서
    - 지원 프로토콜 : TCP, SSL/TLS, HTTP, HTTPS
    - 대상 유형 : EC2-Classic
    - 고정 IP 미제공
    - 보안 그룹 사용
  - ALB(Application Load Balancer)
    - HTTP 헤더 기반 라우팅 -> 웹 어플리케이션에 적합
    - L7 로드 밸런서
    - 지원 프로토콜 : HTTP, HTTPS, gRPC
    - 대상 유형 : IP, 인스턴스, AWS Lambda, 컨테이너
    - 고정 IP 미제공
    - 보안 그룹 사용
  - NLB(Network Load Balancer)
    - 4계층 프로토콜 사용하여 대규모 트래픽 처리 가능 -> 게임 서버, 미디어 스트리밍 등에 적합
    - L4 로드 밸런서
    - 지원 프로토콜 : TCP, UDP, TLS
    - 대상 유형 : IP, 인스턴스, ALB, 컨테이너
    - 고정 IP 제공
    - 보안 그룹 미사용
  - GWLB(GateWay Load Balancer)
    - VPC 내부 라우팅 -> 서드 파티 방화벽, 어플라이언스 대상 트래픽 로드 밸런싱
    - L3 게이트웨이, L4 로드 밸런서
    - 지원 프로토콜 : IP
    - 대상 유형 : IP, 인스턴스
    - 고정 IP 미제공
    - 보안 그룹 사용

### 4.2. (실습) ALB 와 NLB 를 이용한 로드 밸런싱 구성하기 (141p~)

- 4.2.1. CloudFormation 소개
  - CloudFormation : 코드 기반으로 환경을 생성하는 기술
  - 특징
    - IaC(Infrastructure as Code)
      - 수동으로 자원을 만들지 않고 선언된 코드로 자원을 생성
      - 템플릿 기반으로 재사용 가능
      - 변경 사항 추적, 롤백 용이
    - AWS 리소스 간 종속성 관리
      - 템플릿에 종속성을 정의하여 관리 가능
    - 인프라 관리의 자동화
      - CI/CD 파이프라인과 통합 가능
  - 구성 요소
    - 템플릿 : AWS 인프라를 JSON 또는 YAML 형식의 코드로 정의하는 파일
    - 스택 : CloudFormation 을 이용하여 생성하는 AWS 인프라 집합
    - 리소스 : AWS 리소스. EC2 인스턴스, RDS 데이터베이스, S3 버킷 등
    - 파라미터 : 스택 생성 시 전달 가능한 매개변수
    - 이벤트 : 스택에서 발생하는 이벤트 기록
  - 동작
    - CloudFormation 템플릿 작성
    - 템플릿 업로드
    - 스택 생성 또는 업데이트
    - 스택 모니터링
    - 스택 삭제
- 4.2.2. CloudFormation 으로 기본 인프라 배포하기
  - CloudFormation -> 스택 생성
    - 사전 조건-템플릿 준비 : 기존 템플릿 선택
    - 템플릿 지정
      - 템플릿 소스 : Amazon S3 URL
      - Amazon S3 URL : https://cloudneta-aws-book.s3.ap-northeast-2.amazonaws.com/chapter4/elblab.yaml
    - 스택 세부 정보 지정
      - 스택 이름 : elblab
      - KeyName : test-gigyesik
    - 스택 옵션 구성, 검토 : 기본값
  - 생성 결과 확인 (CREATED_COMPLETE)
    - VPC
      - MyVPC : 20.40.0.0/16
      - ELB-VPC : 10.40.0.0/16
    - 인터넷 게이트웨이 : My-IGW, ELB-IGW
    - 퍼블릭 라우팅 테이블
      - MyPublicRT : My-IGW
      - ELBPublicRT : ELB-IGW
    - 서브넷
      - My-Public-SN : MyVPC; 20.40.1.10/24
      - ELBPublicSN1 : ELB-VPC; 10.40.1.0/24
      - ELBPublicSN2 : ELB-VPA; 10.40.2.0/24
    - 보안 그룹
      - MySG : TCP 22, ICMP 허용
      - ELBSG : TCP 22/80, ICMP, UDP 161 허용
    - EC2 인스턴스
      - MyEC2 : My-Public-SN
      - SERVER-1 : ELB-Public-SN1
      - SERVER-2, SERVER-3 : ELB-Public-SN2
- 4.2.3. 기본 인프라 환경 검증하기
  - 환경 구성
    - VPC
      - MyVPC
      - ELB-VPC (각 인스턴스에 HTTP, SNMP 설치)
        - Subnet1
          - Server1
        - Subnet2
          - Server2, Server3
    - 전부 퍼블릭 서브넷
    - User-data 설치됨 (인스턴스 부팅 시 자동으로 수행하는 명령어 집합)
    - HTTP(HyperText Transfer Protocol) : 데이터 전송 프로토콜. 80번 포트(TCP) 사용
    - SNMP(Simple Network Management Protocol) : 네트워크 장비 모니터링, 관리 프로토콜. 161번 포트(UDP) 사용
  - SERVER-1, 2, 3
    - `tree /var/www/html`
    - `cat /var/www/html/xff.php`
  - MyEC2
    - SERVER-1~3 의 퍼블릭 IP 를 변수로 지정
      - `EC21 = ..`
      - `echo $EC21`
    - 웹 서비스 확인
      - `curl $EC21`
      - `curl $EC21/dev/`
      - `curl $EC21/mgt`
      - `curl $EC21/xff.php`
    - SNMP 서비스 확인
      - `snmpget -v2c -c public $EC21 1.3.6.1.2.1.1.5.0`
      - `snmpget -v2c -c public $EC21 1.3.6.1.2.1.1.3.0`
      - OID(Object ID) 정보
        - 1.3.6.1.2.1.1.1.0; sysDescr : 장비 설명
        - 1.3.6.1.2.1.1.2.0; sysObjectID : 장비 고유 ID
        - 1.3.6.1.2.1.1.3.0; sysUpTime : 장비 부팅 ~ 현재 시간(milli-second)
        - 1.3.6.1.2.1.1.5.0; sysName : 사용자가 설정한 장비 이름
- 4.2.4. ALB 를 생성하고 동작 과정 확인하기
  - ALB 생성하기
    - EC2 -> 대상 그룹 -> 대상 그룹 생성
      - 기본 구성
        - 대상 유형 : 인스턴스
        - 대상 그룹 이름 : ALB-TG
        - VPC : ELB-VPC
      - SERVER-1~3 선택 후 '아래에 보류 중인 것으로 포함'
    - EC2 -> 로드 밸런서 -> 로드 밸런서 생성
      - 로드 밸런서 유형 : Application Load Balancer
      - 기본 구성
        - 이름 : ALB
      - 네트워크 매핑
        - VPC : ELB-VPC
        - 매핑 : apne-2a, apne-2c
      - 보안 그룹 : elblab-..
      - 리스너 및 라우팅 : HTTP 80 -> ALB-TG
  - ALB 동작 확인하기
    - MyEC2
      - ALB DNS 이름 변수 지정
        - `ALB=ALB-1540650224.ap-northeast-2.elb.amazonaws.com`
        - `echo $ALB`
      - 도메인에 질의 수행
        - `dig $ALB +short`
        - 두 개의 가용 영역에 생성된 ENI 유동 IP 번갈아가며 출력
      - curl 테스트
        - `curl $ALB`
          - SERVER-1~3 번갈아가며 출력
        - `for i in {1..20}; do curl $ALB --silent ; done | sort | uniq -c | sort -nr`
          - 기본 라운드 로빈 방식으로 1/3 씩 분산되어 출력
      - ALB 는 교차 영역 로드 밸런싱이 기본적으로 활성화되어 있음
- 4.2.5. ALB 경로 기반 라우팅 기능을 구성하고 확인하기
  - MyEC2
    - `curl $ALB/dev/index.html --silent` -> SERVER-1 만 200
    - `curl $ALB/mgt/index.html --silent` -> SERVER-2,3 만 200
  - DEV-TG 대상 그룹 생성
    - EC2 -> 대상 그룹 -> 대상 그룹 생성
      - 이름 : DEV-TG
      - VPC : ELB-VPC
    - SERVER-1 선택 후 '아래에 보류 중인 것으로 포함'
  - MGT-TG 대상 그룹 생성
    - EC2 -> 대상 그룹 -> 대상 그룹 생성
      - 이름 : MGT-TG
      - VPC : ELB-VPC
    - SERVER-2~3 선택 후 '아래에 보류 중인 것으로 포함'
  - 경로 기반 라우팅 설정 규칙 추가
    - EC2 -> 로드 밸런서 -> 리스너 및 규칙 -> 규칙 추가
      - dev
        - 이름 : dev
        - 조건
          - 조건 규칙 유형 : 경로
          - 경로 : `/dev/*`
        - 작업
          - 라우팅 액션 : 대상 그룹으로 전달
          - 대상 그룹 : DEV-TG
        - 규칙 우선 순위 : 임의값
      - mgt
        - 이름 : mgt
        - 조건
          - 조건 규칙 유형 : 경로
          - 경로 : `/mgt/*`
        - 작업
          - 라우팅 액션 : 대상 그룹으로 전달
          - 대상 그룹 : MGT-TG
        - 규칙 우선 순위 : 임의값
  - 결과 확인
    - `curl $ALB/dev/index.html --silent` -> 성공
    - `for i in {1..3}; do curl $ALB/dev/ --silent ; done | sort | uniq -c | sort -nr` -> SERVER-1 만 응답
    - `curl $ALB/mgt/index.html --silent` -> 성공
    - `for i in {1..6}; do curl $ALB/mgt/ --silent ; done | sort | uniq -c | sort -nr` -> SERVER-2, 3 만 응답
    - `for i in {1..9}; do curl $ALB --silent ; done | sort | uniq -c | sort -nr` -> 모두 균일하게 응답
- 4.2.6. ALB 의 User-Agent 를 활용한 로드 밸런싱을 구성하고 확인하기
  - 유동 IP 확인 -> `dig $ALB +short`
  - 스마트폰 브라우저에서 HTTP 접근 확인
  - EC2 -> 로드 밸런서 -> 리스너 및 규칙 -> 규칙 추가
    - 이름 : User-Agent
    - 조건
      - 조건 규칙 유형 : HTTP 헤더
      - HTTP 헤더 이름 : User-Agent
      - HTTP 헤더 값 : `*iPhone*` 또는 `*Android*`
    - 작업
      - 라우팅 액션 : 고정 값 반환
      - 응답 본문 : iPhone or Android Access Deny
  - 결과 확인
    - 스마트폰 접속 : iPhone or Android Access Deny
    - MyEC2 접속 : 성공
    - L7 로드밸런서 이므로 헤더 기반 부하분산 가능
- 4.2.7. NLB 를 생성하고 교차 영역 로드 밸런싱 동작 확인하기
  - EC2 -> 대상 그룹 -> 대상 그룹 생성
    - 대상 그룹 이름 : NLB-TG
    - 프로토콜, 포트 : UDP, 161
    - VPC : ELB-VPC
    - 상태 검사 프로토콜 : HTTP
    - 고급 상태 검사 설정 : 재정의, 80
    - SERVER-1~3 선택 후 '아래에 보류 중인 것으로 포함'
  - EC2 -> 로드 밸런서 -> 로드 밸런서 생성
    - 로드 밸런서 유형 : Network Load Balancer
    - 로드 밸런서 이름 : NLB
    - 네트워크 매핑
      - VPC : ELB-VPC
      - 매핑 : apne2-az1, apne2-az3
      - 보안 그룹 : elblab-..
      - 리스너 및 라우팅
        - 프로토콜 : UDP
        - 포트 : 161
        - 대상 : NLB-TG
  - NLB 동작 확인하기
    - MyEC2
      - NLB DNS 이름을 변수로 지정
        - `NLB=NLB-ccb2792c7526f0ff.elb.ap-northeast-2.amazonaws.com`
        - `echo $NLB`
      - 공인 IP 주소 확인
        - `dig $NLB +short`
      - 공인 IP 주소 변수 저장
        - `NLB1=..`
      - SNMP 서비스 확인
        - `for i in {1..60}; do snmpget -v2c -c public $NLB 1.3.6.1.2.1.1.5.0 ; done | sort | uniq -c | sort -nr`
          - SERVER-1~3
        - `for i in {1..60}; do snmpget -v2c -c public $NLB1 1.3.6.1.2.1.1.5.0 ; done | sort | uniq -c | sort -nr`
          - SERVER-1
        - `for i in {1..60}; do snmpget -v2c -c public $NLB2 1.3.6.1.2.1.1.5.0 ; done | sort | uniq -c | sort -nr`
          - SERVER-2~3
        - NLB 는 교차 영역 로드 밸런싱 기본값 비활성화 되어있음 (라운드 로빈으로 동작)
    - NLB 교차 영역 로드 밸런싱 활성화
      - EC2 -> 로드 밸런서 -> 속성 편집 -> 교차 영역 로드 밸런싱 활성화
      - 결과 확인 -> 교차 영역 로드 밸런싱으로 동작 (NLB1, NLB2 에 요청해도 SERVER-1~3 모두 응답)
- 4.2.8. ALB 와 NLB 의 출발지 IP 보존 확인하기
  - ALB 는 클라이언트 출발지 IP 주소를 자신의 프라이빗 IP 주소로 변경해서 전달
    - SERVER-1 실시간 로그
      - `tail -f /var/log/httpd/access_log | grep -v "ELB-HealthChecker/2.0"`
    - MyEC2 에서 SERVER-1 접속
      - IP 주소 확인 : `curl ipinfo.io/ip`
      - 접속 : `curl $ALB`
    - SERVER-1 접속 패킷 덤프
      - `tcpdump tcp port 80 -nn`
    - 결과 : MyEC2 의 공인 IP 를 ALB 의 사설 IP 로 변환하여 기록
    - 해결하기 : `X-Forwoarded-For` 헤더 추적
      - SERVER-1 로그 설정 정보 확인
        - `grep -n LogFormat /etc/httpd/conf/httpd.conf`
      - 로그 설정 파일 수정
        - `vi /etc/httpd/conf/httpd.conf`
        - 196번째 줄 `%{X-Forwarded-For}i` 추가
          - `LogFormat "%{X-Forwarded-For}i %h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined`
        - `:wq!`
      - HTTP reload
        - `systemctl reload httpd` 
        - reload 와 restart 차이점
          - restart : 해당 서비스를 종료하고 다시 시작
          - reload : conf 설정 파일들만 새로 갱신
      - 실시간 로그 확인시 공인 IP 확인
  - NLB 는 클라이언트 출발지 IP 주소를 보존한 채 전달
    - SERVER-1 패킷 덤프
      - `tcpdump udp port 161 -nn`
    - MyEC2 에서 SERVER-1 접속
      - 내 IP 확인 : `curl ipinfo.io/ip`
      - SERVER-1 접속 : `snmpget -v2c -c public $NLB 1.3.6.1.2.1.1.5.0`
    - 결과 : MyEC2 의 공인 IP 를 보존하여 기록 (NLB 는 4L 로드 밸런서라 XFF 활용 불가)
- 4.2.9. 실습을 위해 생성된 모든 자원 삭제하기
  - EC2 -> 로드 밸런서 삭제
  - EC2 -> 대상 그룹 삭제
  - CloudFormation -> 스택 삭제

## 5장. AWS 스토리지 서비스 (195p~)

### 5.1. 스토리지 개요 (196p~)

- 스토리지(storage) : 데이터를 보관하는 장소

### 5.2. 스토리지 서비스 및 주요 기능 (196p~)

- 5.2.1. 블록 스토리지
  - 단일 스토리지 볼륨(volume)을 블록 단위로 분할해서 저장
  - 블록은 가상 머신 인스턴스에 위치
  - 컴퓨터에 하드디스크 추가, 드라이브 분할해서 사용하는 것과 같은 원리
  - SAN 또는 가상 머신 디스크로 사용
    - SAN(Storage Area Network) : 서로 다른 데이터 저장 장치를 한 데이터 서버에 연결하여 관리하는 네트워크
- 5.2.2. 파일 스토리지
  - 파일 수준, 디렉토리(directory) 구조로 파일 저장 -> 계층 구조
  - 파일이 늘어나면 분류 또는 정리(file system indexing)에 시간이 많이 소요됨
  - NAS 에 사용
    - NAS(Network Attached Storage) : 컴퓨터 네트워크에 연결된 파일 수준의 기억 장치
- 5.2.3. 객체 스토리지
  - 데이터 조각을 객체로 지정하고, 개별 단위로 저장
  - HTTP 프로토콜 기반의 REST API(REpresentational State Transfer Application Programming Interface) 사용
  - 대부분의 스토리지 서비스에 사용
- 5.2.4. 스토리지 선택 기준
  - 내구성 : 데이터 손실 가능성
  - 가용성 : 서비스 지속 시간
  - 보안 : 저장 및 전송 중 데이터 보안
  - 비용 : 스토리지 단위 가격
  - 확장성, 성능 : 스토리지 크기 및 사용자 수 변경
  - 통합: 다른 서비스와 호환성

### 5.3. Amazon EBS (199p~)

- 5.3.1. EBS 란
  - Amazon EBS(Elastic Block Store) : EC2 인스턴스에 사용할 수 있는 블록 스토리지
  - 한 인스턴스에 여러 개 볼륨 연결 가능
  - 한 볼륨은 하나의 인스턴스에만 연결 가능
  - 인스턴스에 종속되어 있지 않아 인스턴스를 삭제해도 볼륨은 재활용 가능
- 5.3.2. EBS 특징
  - 데이터 가용성 : 가용 영역 내에서 자동으로 데이터 복제
  - 데이터 지속성 : 인스턴스 수명과 관계없이 유지되는 비관계형 스토리지
  - 데이터 안정성 : Amazon EBS 암호화(encryption) 기술. 표준 알고리즘(AES-256) 사용
  - 데이터 백업 : 볼륨의 스냅샷(snapshot; 백업)을 Amazon S3 에 백업 가능
  - 데이터 확장성 : 서비스를 중단하지 않고 볼륨 유형, 볼륨 크기, IOPS(Input/Output operations Per Second) 설정 가능
- 5.3.3. EBS 볼륨 유형
  - SSD : 빠른 처리. 주로 OS 영역이나 데이터베이스 보관용 스토리지
  - HDD : 큰 용량. 주로 데이터 분석
- 5.3.4. EBS 스냅샷
  - 특정 시점으로 되돌아갈 수 있는 지점을 만드는 기능
  - Amazon S3 에 저장되어 여러 가용 영역에 자동으로 복제
- 5.3.5. EFS 란
  - Amazon EFS(Elastic File System) : 완전 관리형 네트워크 파일 시스템
  - 완전 관리형 : 하드웨어/소트프웨어 구성, 모니터링, 성능 조절 등 관리
- 5.3.6. EFS 특징
  - 여러 대의 컴퓨터가 네트워크상의 동일한 데이터에 접근해야 할 때 사용
  - NFS 표준 프로토콜 기반
    - NFS(Network File System) : 원격 호스트 파일을 다른 시스템이 로컬에서 가용할 수 있도록 구현
  - NAS 보다 뛰어난 성능(EBS 는 가용 영역 기반이지만 EFS 는 가용 영역 전반에 걸쳐 사용 가능)

### 5.4. Amazon S3 (205p~)

- 5.4.1. S3 소개
  - Amazon S3(Simple Storage Service) : AWS 서비스 중 가장 기본이 되는 객체 스토리지 서비스
    - 객체 : S3 에 저장되는 데이터
    - 버킷(bucket) : 객체 저장소
  - HTTP 프로토콜 입출력 사용
  - REST API 를 이용한 명령 전달
- 5.4.2. S3 구성 요소
  - 버킷 : 데이터 스토리지를 위한 S3 기본 컨테이너(container)
  - 객체 : S3 에 저장되는 기본 매체
    - 객체 데이터 + 메타데이터
  - 키 : 객체 고유 식별자
  - S3 데이터 일관성 : 여러 서버로 데이터 복제하여 고가용성, 내구성 구현
- 5.4.3. S3 특징
  - 물리적으로 분리된 가용 영역에 데이터를 복제해서 저장
  - 동일 버킷 내 여러 객체의 변형을 보유하여 데이터 복구에 특화
  - 다른 서비스와 유기적으로 연동하여 사용 가능
- 5.4.4. S3 스토리지 클래스
  - S3 standard : 자주 엑세스하는 데이터
  - S3 - IA : 엑세스 빈도가 낮은 데이터
  - glacier : 거의 엑세스하지 않는 데이터
- 5.4.5. S3 보안
  - 식별자 기반으로 어디서나 접근 가능 -> 보안 필수
  - AWS IAM 으로 관리 가능 : 특정 S3 버킷 접근
  - S3 내 버킷 정책으로 관리 가능 : 특정 객체 접근

### 5.5. (실습) 다양한 AWS 스토리지 서비스 구성하기 (211p~)

- 5.5.1. 실습에 필요한 기본 인프라 배포하기
  - CloudFormation -> 스택 생성
    - Amazon S3 URL : `https://cloudneta-aws-book.s3.ap-northeast-2.amazonaws.com/chapter5/storagelab.yaml`
    - 스택 이름 : storagelab
    - KeyName : test-gigyesik
    - 검토
      - `AWS CloudFormation 에서 사용자 지정 이름으로 IAM 리소스를 생성할 수 있음을 승인합니다.` 체크
  - 현재 인프라 정보
    - 서울 리전
    - CH5-VPC (10.4.0.0/16)
    - 가용 영역
      - AZ1
        - Public Subnet 1 (10.4.1.0/24)
          - EC2 - STG1
          - EBS Root Volume
      - AZ1
        - Public Subnet 2 (10.4.2.0/24)
          - EC2 - STG 2
          - EBS Rook Volume
    - 퍼블릭 라우팅 테이블 (CH5-Public-RT)
    - IAM Role : STGLabRoleForInstances (S3 Full 정책 연동)
    - 보안 그룹 : TCP 22/80/249, ICMP 허용
    - 인터넷 게이트웨이(IGW)
  - EBS 스토리지 기본 경로 확인
    - STG1 SSH 접속
      - 디스크 여유 공간 확인 (disk free)
        - `df -hT /dev/xvda1`
      - 사용 가능한 디스크 디바이스와 마운트 포인트 확인
        - `lsblk`
      - 디바이스 UUID 확인
        - `blkid`
      - 디바이스 탑재 지점 확인
        - `cat /etc/fstab`
- 5.5.2. EBS 스토리지를 추가로 생성한 후 사용하기
  - EC2 -> EBS -> 볼륨 -> 볼륨 생성
    - 볼륨 유형 : 범용 SSD(gp3)
    - 크기 : 20 GiB
    - 가용 영역 : ap-northeast-2a
    - 태그 추가
      - 키 : Name
      - 값 : Data1
  - EBS -> 작업 -> 볼륨 연결
    - 인스턴스 : EC2-STG1
    - 디바이스 : /dev/sdf
  - 연결된 EBS 볼륨 사용 설정
    - 디바이스 추가 확인
      - `lsblk`
    - 볼륨을 포맷하여 파일 시스템 생성
      - `mkfs -t xfs /dev/xvdf`
    - 디렉토리를 생성한 후 마운트
      - `mkdir /data`
      - `mount /dev/xvdf /data`
    - 파일을 생성한 후 확인
      - `echo "EBS Test" > /data/memo.txt`
      - `cat /data/memo.txt`
    - 디바이스 확인
      - `lsblk`
      - `df -hT /dev/xvdf`
  - 재부팅 이후에도 볼륨 자동 탑재 설정
    - 파일 시스템 정보 확인
      - `cat /etc/fstab`
    - 장작할 볼륨 정보 확인
      - `blkid`
    - fstab 에 마운트 정보 입력
      - `echo "UUID=(device UUID) /data xfs defaults,nofail 0 2" >> /etc/fstab`
      - 자동 마운트 설정 (/etc/fstab)
        - `(장치명) (마운트 위치) (파일 시스템) (속성) (덤프 사용 여부) (파일 시스템 체크 여부)`
    - 다시 정보 확인
      - `cat /etc/fstab`
- 5.5.3. EBS 스토리지의 볼륨 크기를 변경하고 스냅샷 기능 확인하기
  - EBS 볼륨 크기 변경하기
    - EC2 -> EBS -> 볼륨 -> 수정
      - 볼륨 유형 : 범용 SSD(gp3)
      - 크기 : 20 GiB
      - IOPS : 3000
      - 처리량 : 125
    - 파일 시스템 확장(파티션 조정, 파일 시스템 조정)
      - 볼륨 상태 확인
        - `lsblk`
        - `df -hT /dev/xvda1`
      - 파티션 확장(파티션 조정)
        - `growpart /dev/xvda 1`
      - 볼륨 상태 확인
        - `lsblk`
      - 파일 시스템 확장(파일 시스템 조정)
        - `xfs_growfs -d /`
      - 변경된 파일 시스템 확인
        - `df -hT /dev/xvda1`
  - EBS 스냅샷 기능 확인하기
    - 가상 파일 생성 후 확인
      - `fallocate -l 10G /home/10G.dummy`
      - `df -hT /dev/xvda1`
    - EC2 -> EBS -> 볼륨 -> 작업 -> 스냅샷 생성
      - 설명 : FirstSnapshot
    - EC2 -> EBS -> 스냅샷 에서 결과 확인
    - 가상 파일 생성 후 확인
      - `fallocate -l 5G /home/5G.dummy`
      - `df -hT /dev/xvda1`
    - EC2 -> EBS -> 볼륨 -> 작업 -> 스냅샷 생성
      - 설명 : SecondSnapshot
    - EC2 -> EBS -> 스냅샷 에서 결과 확인
- 5.5.4. EFS 스토리지 생성하고 사용하기
  - EFS -> 파일 시스템 -> 파일 시스템 생성 -> 사용자 지정
    - 일반
      - 이름 : cloudneta
      - 자동 백업 활성화 : 체크 해제
      - Infrequent Access(IA) 로 전환 : 없음
      - 유휴 시 데이터 암호화 활성화 : 체크 해제
    - 네트워크
      - VPC : CH5-VPC
      - 보안 그룹 : storagelab-MySG-.. (TCP 2049 인바운드 허용)
  - EFS 사용 설정 (EC2-1, 2)
    - 리전별 웹 서버 동작 확인
      - `curl localhost`
    - efs 디렉토리 생성
      - `mkdir /var/www/html/efs`
    - EFS 파일 시스템 ID 변수 지정
      - `EFS=(파일 시스템 ID)`
    - 마운트
      - `mount -t efs -o tls $EFS:/ /var/www/html/efs`
    - 마운트한 곳에 파일 생성 후 확인
      - `echo "<html><h1>Hello from Amazon EFS</h1></html>" > /var/www/html/efs/index.html`
      - `curl localhost/efs/`
    - EFS Size 확인
      - `df -hT | grep efs`
    - EFS DNS 주소 확인 (각 AZ 에 속한 인터페이스 ID)
      - `dig +short $EFS.efs.ap-northeast-2.amazonaws.com`
  - EFS 를 이용하여 파일 공유
    - EC2-1 에서 파일 생성
      - `for i in {1..100}; do touch /var/www/html/efs/deleteme.$i; done;`
    - EC2-2 에서 확인
      - `ls /var/www/html/efs`
    - EC2-2 에서 파일 삭제
      - `rm -rf /var/www/html/efs/deleteme*.*`
    - EC2-1 에서 확인
      - `ls /var/www/html/efs`
  - 현재 인프라 정보
    - 서울 리전
    - CH5-VPC (10.4.0.0/16)
    - 가용 영역
      - AZ1
        - Public Subnet 1 (10.4.1.0/24)
          - EC2 - STG1
          - EBS Root Volume
          - EBS Data Volume
      - AZ1
        - Public Subnet 2 (10.4.2.0/24)
          - EC2 - STG 2
          - EBS Rook Volume
    - 퍼블릭 라우팅 테이블 (CH5-Public-RT)
    - 스냅샷
    - Amazon EFS
    - IAM Role : STGLabRoleForInstances (S3 Full 정책 연동)
    - 보안 그룹 : TCP 22/80/249, ICMP 허용
    - 인터넷 게이트웨이(IGW)
- 5.5.5. Public S3 스토리지로 외부 접근 확인하기
  - S3 -> 버킷 -> 버킷 만들기
    - 버킷 이름 : cloudneta1
    - 리전 : apne-2
    - 객체 소유권 : ACL 활성화됨
    - 이 버킷의 퍼블릭 엑세스 차단 설정 : 체크 해제
      - 현재 설정으로 인해 이 버킷과 그 안에 포함된 객체가 퍼블릭 상태가 될 수 있음을 알고 있습니다 : 체크
  - 버킷 -> 업로드 -> 파일 추가 -> 이미지 파일 하나 업로드
    - 객체 URL 로 접근시 Access Denied
  - 외부에서 접근 허용 : 파일 -> 객체 작업 -> ACL 을 사용해 퍼블릭으로 설정 -> 퍼블릭으로 설정
  - EC2-1 이미지 링크 추가 (/var/www/html/index.html)
  ```html
    <html>
          <body>
  
          <h1>Cloudneta S3 Storage</h1>
          <img src="https://cloudneta1.s3.ap-northeast-2.amazonaws.com/2024-06-09-blog-github-pages-2-quickstart-3-source-saved.png">
          </body>
    </html>
  ```
  - EC2-1 퍼블릭 IP 로 접속해서 이미지 확인
  - 버킷 권한 자동 설정
    - 버킷 -> 권한 탭 -> 버킷 정책 편집
    ```json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Sid": "PublicReadGetObject",
          "Effect": "Allow",
          "Principal": "*",
          "Action": [
            "s3:GetObject"
          ],
          "Resource": [
            "arn:aws:s3:::cloudneta1/*"
          ]      
        } 
      ]
    }
    ```
    - 현재 인프라 정보
    - 서울 리전
    - CH5-VPC (10.4.0.0/16)
    - 가용 영역
      - AZ1
        - Public Subnet 1 (10.4.1.0/24)
          - EC2 - STG1
          - EBS Root Volume
          - EBS Data Volume
      - AZ1
        - Public Subnet 2 (10.4.2.0/24)
          - EC2 - STG 2
          - EBS Rook Volume
    - 퍼블릭 라우팅 테이블 (CH5-Public-RT)
    - 스냅샷
    - Amazon EFS
    - IAM Role : STGLabRoleForInstances (S3 Full 정책 연동)
    - 보안 그룹 : TCP 22/80/249, ICMP 허용
    - Amazon S3 Public
    - 인터넷 게이트웨이(IGW)
- 5.5.6. Private S3 스토리지의 제한된 접근 및 데이터 백업하기
  - Private 버킷 생성 (AWS CLI)
    - EC2-1
      - 기존 s3 조회
        - `aws s3 ls`
      - s3 버킷 생성 (make bucket)
        - `aws s3 mb s3://(s3 버킷 이름)`
      - 버킷 이름을 변수에 지정
        - `MyS3=(버킷 이름)`
      - 파일 생성 후 S3 에 업로드
        - `echo "111" > /var/www/html/111.txt`
        - `aws s3 cp /var/www/html/111.txt s3://$MyS3`
        - `aws s3 ls s3://$MyS3`
      - 웹 디렉토리(하위 포함)을 S3 버킷에 업로드(수동 백업) 후 확인
        - `aws s3 sync --delete /var/www/html s3://$MyS3`
        - `aws s3 ls s3://$MyS3 --recursive`
      - crontab 내용 추가 (/etc/crontab)
        - `*/1 * * * * root aws s3 sync --delete /var/www/html s3://cloudneta1-s3-private`
      - 적용 및 추가 파일 생성
        - `systemctl restart crond`
        - `echo "222" > /var/www/html/222.txt`
        - `echo "333" > /var/www/html/333.txt`
      - 실시간 버킷 조회 후 로그 확인
        - `while true; do aws s3 ls s3://$MyS3; date; echo "---[S3 ls]---"; sleep 3; done` 
        - `tail -f /var/log/cron`
      - 테스트 파일 생성 후 S3 에 업로드
        - `echo "presigned test" > /var/www/html/presigned.txt`
        - `aws s3 cp /var/www/html/presigned.txt s3://$MyS3`
      - 객체 URL 로 직접 접근은 불가하나 Pre-Sign URL 생성
        - `aws s3 presign s3://$MyS3/presigned.txt --expires-in 120`
        - 생성된 URL 로 웹 접근 가능 확인
- 5.5.7. 실습을 위해 생성된 모든 자원 삭제하기
  - EC2 -> EBS -> 스냅샷 -> 스냅샷 삭제
  - EC2 -> EBS -> 볼륨 -> Data1 볼륨 분리, 볼륨 삭제
  - EFS -> 파일 시스템 -> 파일 시스템 삭제
  - S3 -> 버킷 -> 비어 있음 (포맷), 삭제
  - CloudFormation -> 스택 -> 삭제

## 6장. AWS 데이터베이스 서비스 (243p~)

### 6.1. 데이터베이스와 DBMS (244p~)

- 6.1.1. 데이터와 데이터베이스
  - 데이터(Data) : 측정하고 수집한 값
  - 정보 : 데이터를 특정 목적에 따라 가공하여 의미를 부여한 결과
  - 데이터베이스 : 데이터의 집합
  - DBMS(DataBase Management System) : 데이터베이스 관리 시스템
- 6.1.2. 데이터베이스 모델 유형
  - 계층형(hierarchical)
    - 트리(tree) 구조 기반
    - 1:N
    - 데이터에 빠른 접근 가능
    - 구조 변경 유연성 떨어짐
  - 네트워크형
    - 1:N, 1:1, N:N
    - 형태가 계층형에 비해 자유로움
    - 개체간 연결에 따라 복잡성 증가
  - 관계형(relational)
    - column(열), row(행), 테이블
    - 데이터 구조 변화에 쉽게 적응, 가장 보편적
    - 시스템 자원을 많이 차지하여 속도 느림 -> 하드웨어 발전으로 해소중
    - SQL(Structured Query Language) 사용
  - 객체 지향형(object-oriented)
    - object(객체)
    - 복잡한 객체 구조, 비정형 데이터도 지원
    - 관계형 데이터베이스와 호환성, 복잡성 문제
- 6.1.3. 관계형 DBMS 의 SQL 언어
  - SQL 데이터 정의
    - CREATE : 데이블 구성, 속성 제약 정의
    - ALTER : 생성된 테이블 속성 정의, 변경
    - DROP : 생성된 테이블 삭제
  - SQL 데이터 조작
    - SELECT : 정보 조회
    - INSERT : 데이터 삽입
    - UPDATE : 데이터 수정
    - DELETE : 데이터 삭제
  - SQL 데이터 제어
    - GRANT : 테이블 권한 허용
    - DENY : 테이블 권한 차단
    - REVOKE : 테이블 권한 회수
- 6.1.4. DBMS 종류
  - https://db-engines.com/en/ranking

### 6.2. AWS 데이터베이스 서비스 (249p~)

- 6.2.1. Amazon RDS
  - Amazon RDS(Relational Database Service) : 클라우드 환경의 관계형 데이터베이스 서비스
  - 다양한 관계형 데이터베이스 엔진 지원, SQL 사용 
- 6.2.2. Amazon RDS 데이터 복제
  - Multi-AZ 복제 방식
    - 액티브-스탠바이(active-standby) 방식
    - 스탠바이(Standby Replica)가 액티브(Primary DB)를 동기식 복제(synchronous replica)
  - Read Replica 복제 방식
    - 읽기 전용 데이터를 Read Replica 에 복제
    - 비동기식 복제 사용
    - 다른 리전에도 복제 가능
- 6.2.3. Amazon Aurora
  - Amazon Aurora : Amazon RDS 상에서 동작하는 AWS 자체 클라우드 데이터베이스 엔진
  - Amazon Aurora 복제 방식 : 공유 스토리지를 통해 비동기식 복제
- 6.2.4. Amazon DynamoDB
  - 비관계형 데이터베이스. 키-값(key-value) 사용
  - NoSQL 데이터베이스 (비관계형 이므로 SQL 사용하지 않음)
- 6.2.5. Amazon ElastiCache
  - 인-메모리(in-memory) 데이터에이스
  - Amazon ElastiCache for Memcached : 보편적인 메모리 객체 캐싱 시스템
  - Amazon ElastiCache for Redis : 오픈소스인 Redis 기반 구축

### 6.3. (실습) 웹 서버와 Amazon RDS 연동하기 (255p~)